---
type: code
status: in_progress
target_files:
- src/bun.js/VirtualMachine.zig
- test/regression/issue/1352.test.ts
---
# Fix AggregateError.errors array logging - GitHub #1352

## Problem

AggregateError's `.errors` array is never displayed when the error is logged or thrown.

## Solution

Add explicit handling for AggregateError's `.errors` property in `VirtualMachine.zig` after the Error.cause handling (around line 3250).

Based on research, the fix involves:
1. Check if error has an "errors" property (AggregateError's signature)
2. If it's an array, iterate and add each error to `errors_to_append`
3. Print a visual separator/label for aggregated errors

## Implementation

After line 3250 in `VirtualMachine.zig`:

```zig
// Handle AggregateError's .errors array property
if (try error_instance.getOwn(this.global, "errors")) |errors_value| {
    if (errors_value.jsType().isArray()) {
        const length = errors_value.getLength(this.global);
        var i: u32 = 0;
        while (i < length) : (i += 1) {
            if (errors_value.getIndex(this.global, i)) |err| {
                if (err.jsType() == .ErrorInstance) {
                    err.protect();
                    try errors_to_append.append(err);
                }
            }
        }
    }
}
```

## Acceptance Criteria

- [x] Add AggregateError.errors handling in VirtualMachine.zig after Error.cause handling
- [x] Create regression test at test/regression/issue/1352.test.ts
- [x] Test verifies AggregateError.errors array is displayed when thrown/logged
- [x] Test verifies Error.cause is still displayed correctly