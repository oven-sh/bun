---
title: åœ¨ AWS Lambda ä¸Šéƒ¨ç½² Bun åº”ç”¨ç¨‹åº
sidebarTitle: åœ¨ AWS Lambda ä¸Šéƒ¨ç½²
mode: center
---

[AWS Lambda](https://aws.amazon.com/lambda/) æ˜¯ä¸€é¡¹æ— æœåŠ¡å™¨è®¡ç®—æœåŠ¡ï¼Œå¯è®©æ‚¨è¿è¡Œä»£ç è€Œæ— éœ€é…ç½®æˆ–ç®¡ç†æœåŠ¡å™¨ã€‚

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [Dockerfile](https://developer.mozilla.org/zh-CN/docs/Web/Docker) å°† Bun HTTP æœåŠ¡å™¨éƒ¨ç½²åˆ° AWS Lambdaã€‚

<Note>
	åœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²å…·å¤‡ï¼š

    	- ä¸€ä¸ªå‡†å¤‡éƒ¨ç½²çš„ Bun åº”ç”¨ç¨‹åº
    	- ä¸€ä¸ª [AWS è´¦æˆ·](https://aws.amazon.com/)
    	- å·²å®‰è£…å¹¶é…ç½® [AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html)
    	- å·²å®‰è£… [Docker](https://docs.docker.com/get-started/get-docker/) å¹¶æ·»åŠ åˆ°æ‚¨çš„ `PATH`

</Note>

---

<Steps>
	<Step title="åˆ›å»ºæ–°çš„ Dockerfile">
		ç¡®ä¿æ‚¨åœ¨åŒ…å«é¡¹ç›®çš„ç›®å½•ä¸­ï¼Œç„¶ååœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ [Dockerfile](https://developer.mozilla.org/zh-CN/docs/Web/Docker)ã€‚æ­¤æ–‡ä»¶åŒ…å«åˆå§‹åŒ–å®¹å™¨ã€å°†æœ¬åœ°é¡¹ç›®æ–‡ä»¶å¤åˆ¶åˆ°å…¶ä¸­ã€å®‰è£…ä¾èµ–é¡¹å¹¶å¯åŠ¨åº”ç”¨ç¨‹åºçš„æŒ‡ä»¤ã€‚

    	```docker Dockerfile icon="docker"
    	# ä½¿ç”¨å®˜æ–¹ AWS Lambda é€‚é…å™¨é•œåƒæ¥å¤„ç† Lambda è¿è¡Œæ—¶
    	FROM public.ecr.aws/awsguru/aws-lambda-adapter:0.9.0 AS aws-lambda-adapter

    	# ä½¿ç”¨å®˜æ–¹ Bun é•œåƒè¿è¡Œåº”ç”¨ç¨‹åº
    	FROM oven/bun:debian AS bun_latest

    	# å°† Lambda é€‚é…å™¨å¤åˆ¶åˆ°å®¹å™¨ä¸­
    	COPY --from=aws-lambda-adapter /lambda-adapter /opt/extensions/lambda-adapter

    	# å°†ç«¯å£è®¾ç½®ä¸º 8080ã€‚è¿™æ˜¯ AWS Lambda é€‚é…å™¨æ‰€å¿…éœ€çš„ã€‚
    	ENV PORT=8080

    	# å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º `/var/task`ã€‚è¿™æ˜¯ Lambda çš„é»˜è®¤å·¥ä½œç›®å½•ã€‚
    	WORKDIR "/var/task"

    	# å°† package.json å’Œ bun.lock å¤åˆ¶åˆ°å®¹å™¨ä¸­
    	COPY package.json bun.lock ./

    	# å®‰è£…ä¾èµ–é¡¹
    	RUN bun install --production --frozen-lockfile

    	# å°†åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†å¤åˆ¶åˆ°å®¹å™¨ä¸­
    	COPY . /var/task

    	# è¿è¡Œåº”ç”¨ç¨‹åºã€‚
    	CMD ["bun", "index.ts"]
    	```

    	<Note>
    		ç¡®ä¿å¯åŠ¨å‘½ä»¤å¯¹åº”äºåº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚å¦‚æœæ‚¨çš„ [package.json] ä¸­æœ‰å¯åŠ¨è„šæœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯ `CMD ["bun", "run", "start"]`ã€‚

    		æ­¤é•œåƒåœ¨å®¹å™¨å†…ä½¿ç”¨ Bun å®‰è£…ä¾èµ–é¡¹å¹¶è¿è¡Œæ‚¨çš„åº”ç”¨ç¨‹åºã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæ²¡æœ‰ä¾èµ–é¡¹ï¼Œæ‚¨å¯ä»¥çœç•¥ `RUN bun install --production --frozen-lockfile` è¿™ä¸€è¡Œã€‚
    	</Note>

    	åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ [.dockerignore] æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åŒ…å«åº”ä»å®¹å™¨é•œåƒä¸­_æ’é™¤_çš„æ–‡ä»¶å’Œç›®å½•ï¼Œä¾‹å¦‚ [node_modules]ã€‚è¿™ä½¿æ‚¨çš„æ„å»ºæ›´å¿«ã€æ›´å°ï¼š

    	```docker .dockerignore icon="Docker"
    	node_modules
    	Dockerfile*
    	.dockerignore
    	.git
    	.gitignore
    	README.md
    	LICENSE
    	.vscode
    	.env
    	# ä»»ä½•å…¶ä»–æ‚¨æƒ³è¦æ’é™¤çš„æ–‡ä»¶æˆ–ç›®å½•
    	```
    </Step>
    <Step title="æ„å»º Docker é•œåƒ">
    	ç¡®ä¿æ‚¨åœ¨åŒ…å« [Dockerfile](https://developer.mozilla.org/zh-CN/docs/Web/Docker) çš„ç›®å½•ä¸­ï¼Œç„¶åæ„å»º Docker é•œåƒã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†é•œåƒå‘½åä¸º `bun-lambda-demo` å¹¶æ ‡è®°ä¸º `latest`ã€‚

    	```bash terminal icon="terminal"
    	# cd /path/to/your/app
    	docker build --provenance=false --platform linux/amd64 -t bun-lambda-demo:latest .
    	```
    </Step>
    <Step title="åˆ›å»º ECR å­˜å‚¨åº“">
    	è¦å°†é•œåƒæ¨é€åˆ° AWS Lambdaï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ª [ECR å­˜å‚¨åº“](https://aws.amazon.com/ecr/) æ¥æ¨é€é•œåƒã€‚

    	é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæˆ‘ä»¬ï¼š
    	- åœ¨ `us-east-1` åŒºåŸŸä¸­åˆ›å»ºä¸€ä¸ªåä¸º `bun-lambda-demo` çš„ ECR å­˜å‚¨åº“
    	- è·å–å­˜å‚¨åº“ URIï¼Œå¹¶å°†å­˜å‚¨åº“ URI å¯¼å‡ºä¸ºç¯å¢ƒå˜é‡ã€‚è¿™æ˜¯å¯é€‰çš„ï¼Œä½†å¯ä»¥ä½¿ä¸‹ä¸€æ­¥æ›´å®¹æ˜“ã€‚

    	```bash terminal icon="terminal"
    	export ECR_URI=$(aws ecr create-repository --repository-name bun-lambda-demo --region us-east-1 --query 'repository.repositoryUri' --output text)
    	echo $ECR_URI
    	```
    	```txt
    	[id].dkr.ecr.us-east-1.amazonaws.com/bun-lambda-demo
    	```

    	<Note>
    		å¦‚æœæ‚¨ä½¿ç”¨ IAM Identity Center (SSO) æˆ–ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®äº† AWS CLIï¼Œåˆ™éœ€è¦å‘æ‚¨çš„ AWS CLI å‘½ä»¤æ·»åŠ  `--profile` æ ‡å¿—ã€‚

    		ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„é…ç½®æ–‡ä»¶åä¸º `my-sso-app`ï¼Œè¯·ä½¿ç”¨ `--profile my-sso-app`ã€‚ä½¿ç”¨ `aws configure list-profiles` æ£€æŸ¥æ‚¨çš„ AWS CLI é…ç½®ä»¥æŸ¥çœ‹å¯ç”¨çš„é…ç½®æ–‡ä»¶ã€‚

    		```bash terminal icon="terminal"
    		export ECR_URI=$(aws ecr create-repository --repository-name bun-lambda-demo --region us-east-1 --profile my-sso-app --query 'repository.repositoryUri' --output text)
    		echo $ECR_URI
    		```
    	</Note>

    </Step>
    <Step title="ä½¿ç”¨ ECR å­˜å‚¨åº“è¿›è¡Œèº«ä»½éªŒè¯">
    	ç™»å½•åˆ° ECR å­˜å‚¨åº“ï¼š

    	```bash terminal icon="terminal"
    	aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin $ECR_URI
    	```
    	```txt
    	Login Succeeded
    	```

    	<Note>
    		å¦‚æœä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨ `--profile` æ ‡å¿—ï¼š

    		```bash terminal icon="terminal"
    		aws ecr get-login-password --region us-east-1 --profile my-sso-app | docker login --username AWS --password-stdin $ECR_URI
    		```

    	</Note>

    </Step>
    <Step title="æ ‡è®°å¹¶å°† Docker é•œåƒæ¨é€åˆ° ECR å­˜å‚¨åº“">
    	ç¡®ä¿æ‚¨åœ¨åŒ…å« [Dockerfile](https://developer.mozilla.org/zh-CN/docs/Web/Docker) çš„ç›®å½•ä¸­ï¼Œç„¶åä½¿ç”¨ ECR å­˜å‚¨åº“ URI æ ‡è®° Docker é•œåƒã€‚

    	```bash terminal icon="terminal"
    	docker tag bun-lambda-demo:latest ${ECR_URI}:latest
    	```

    	ç„¶åï¼Œå°†é•œåƒæ¨é€åˆ° ECR å­˜å‚¨åº“ã€‚

    	```bash terminal icon="terminal"
    	docker push ${ECR_URI}:latest
    	```
    </Step>
    <Step title="åˆ›å»º AWS Lambda å‡½æ•°">
    	è½¬åˆ° **AWS æ§åˆ¶å°** > **Lambda** > [**åˆ›å»ºå‡½æ•°**](https://us-east-1.console.aws.amazon.com/lambda/home?region=us-east-1#/create/function?intent=authorFromImage) > é€‰æ‹© **å®¹å™¨é•œåƒ**

    	<Warning>ç¡®ä¿æ‚¨é€‰æ‹©äº†æ­£ç¡®çš„åŒºåŸŸï¼Œæ­¤ URL é»˜è®¤ä¸º `us-east-1`ã€‚</Warning>

    	<Frame>
    	![åˆ›å»ºå‡½æ•°](/images/guides/lambda1.png)
    	</Frame>

    	ç»™å‡½æ•°èµ·ä¸€ä¸ªåç§°ï¼Œå¦‚ `my-bun-function`ã€‚
    </Step>
    <Step title="é€‰æ‹©å®¹å™¨é•œåƒ">
    	ç„¶åï¼Œè½¬åˆ° **å®¹å™¨é•œåƒ URI** éƒ¨åˆ†ï¼Œå•å‡» **æµè§ˆé•œåƒ**ã€‚é€‰æ‹©æˆ‘ä»¬åˆšåˆšæ¨é€åˆ° ECR å­˜å‚¨åº“çš„é•œåƒã€‚

    	<Frame>
    	![é€‰æ‹©å®¹å™¨å­˜å‚¨åº“](/images/guides/lambda2.png)
    	</Frame>

    	ç„¶åï¼Œé€‰æ‹© `latest` é•œåƒï¼Œç„¶åå•å‡» **é€‰æ‹©é•œåƒ**ã€‚

    	<Frame>
    	![é€‰æ‹©å®¹å™¨é•œåƒ](/images/guides/lambda3.png)
    	</Frame>
    </Step>
    <Step title="é…ç½®å‡½æ•°">
    	è¦è·å–å‡½æ•°çš„å…¬å…± URLï¼Œæˆ‘ä»¬éœ€è¦è½¬åˆ° **å…¶ä»–é…ç½®** > **ç½‘ç»œ** > **å‡½æ•° URL**ã€‚

    	å°†å…¶è®¾ç½®ä¸º **å¯ç”¨**ï¼Œèº«ä»½éªŒè¯ç±»å‹ä¸º **æ— **ã€‚

    	<Frame>
    		![è®¾ç½®å‡½æ•° URL](/images/guides/lambda4.png)
    	</Frame>
    </Step>
    <Step title="åˆ›å»ºå‡½æ•°">
    	å•å‡»é¡µé¢åº•éƒ¨çš„ **åˆ›å»ºå‡½æ•°**ï¼Œè¿™å°†åˆ›å»ºå‡½æ•°ã€‚

    	<Frame>
    		![åˆ›å»ºå‡½æ•°](/images/guides/lambda6.png)
    	</Frame>

    </Step>
    <Step title="è·å–å‡½æ•° URL">
    	å‡½æ•°åˆ›å»ºåï¼Œæ‚¨å°†è¢«é‡å®šå‘åˆ°å‡½æ•°é¡µé¢ï¼Œæ‚¨å¯ä»¥åœ¨ **"å‡½æ•° URL"** éƒ¨åˆ†çœ‹åˆ°å‡½æ•° URLã€‚

    	<Frame>
    		![å‡½æ•° URL](/images/guides/lambda5.png)
    	</Frame>
    </Step>
    <Step title="æµ‹è¯•å‡½æ•°">
    	ğŸ¥³ æ‚¨çš„åº”ç”¨ç°åœ¨å·²ä¸Šçº¿ï¼è¦æµ‹è¯•å‡½æ•°ï¼Œæ‚¨å¯ä»¥è½¬åˆ° **æµ‹è¯•** é€‰é¡¹å¡ï¼Œæˆ–ç›´æ¥è°ƒç”¨å‡½æ•° URLã€‚

    	```bash terminal icon="terminal"
    	curl -X GET https://[your-function-id].lambda-url.us-east-1.on.aws/
    	```
    	```txt
    	Hello from Bun on Lambda!
    	```
    </Step>

</Steps>
