---
title: åœ¨ Google Cloud Run ä¸Šéƒ¨ç½² Bun åº”ç”¨ç¨‹åº
sidebarTitle: åœ¨ Google Cloud Run ä¸Šéƒ¨ç½²
mode: center
---

[Google Cloud Run](https://cloud.google.com/run) æ˜¯ä¸€ä¸ªç”¨äºéƒ¨ç½²å’Œæ‰©å±•æ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„æ‰˜ç®¡å¹³å°ã€‚Google ä¸ºæ‚¨å¤„ç†åŸºç¡€è®¾æ–½ã€‚

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [Dockerfile] å°† Bun HTTP æœåŠ¡å™¨éƒ¨ç½²åˆ° Google Cloud Runã€‚

<Note>
	åœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²å…·å¤‡ï¼š

    - ä¸€ä¸ªå‡†å¤‡éƒ¨ç½²çš„ Bun åº”ç”¨ç¨‹åº
    - ä¸€ä¸ªå¯ç”¨è®¡è´¹çš„ [Google Cloud è´¦æˆ·](https://cloud.google.com/)
    - å·²å®‰è£…å¹¶é…ç½® [Google Cloud CLI](https://cloud.google.com/sdk/docs/install)

</Note>

---

<Steps> 
<Step title={<span>é€šè¿‡é€‰æ‹©/åˆ›å»ºé¡¹ç›®åˆå§‹åŒ– <code>gcloud</code></span>}>

ç¡®ä¿æ‚¨å·²åˆå§‹åŒ– Google Cloud CLIã€‚æ­¤å‘½ä»¤å°†æ‚¨ç™»å½•ï¼Œå¹¶æç¤ºæ‚¨é€‰æ‹©ç°æœ‰é¡¹ç›®æˆ–åˆ›å»ºæ–°é¡¹ç›®ã€‚

æœ‰å…³ Google Cloud CLI çš„æ›´å¤šå¸®åŠ©ï¼Œè¯·å‚é˜… [å®˜æ–¹æ–‡æ¡£](https://docs.cloud.google.com/sdk/gcloud/reference/init)ã€‚

```bash terminal icon="terminal"
gcloud init
```

```txt
Welcome! This command will take you through the configuration of gcloud.

You must sign in to continue. Would you like to sign in (Y/n)? Y
You are signed in as [email@example.com].

Pick cloud project to use:
 [1] existing-bun-app-1234
 [2] Enter a project ID
 [3] Create a new project
Please enter numeric choice or text value (must exactly match list item): 3

Enter a Project ID. my-bun-app
Your current project has been set to: [my-bun-app]

The Google Cloud CLI is configured and ready to use!
```

</Step>
<Step title="ï¼ˆå¯é€‰ï¼‰å°†é¡¹ç›®ä¿¡æ¯å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­">
ä¸ºé¡¹ç›® ID å’Œç¼–å·è®¾ç½®å˜é‡ï¼Œä»¥ä¾¿åœ¨åç»­æ­¥éª¤ä¸­æ›´å®¹æ˜“é‡ç”¨ã€‚

```bash terminal icon="terminal"
PROJECT_ID=$(gcloud projects list --format='value(projectId)' --filter='name="my bun app"')
PROJECT_NUMBER=$(gcloud projects list --format='value(projectNumber)' --filter='name="my bun app"')

echo $PROJECT_ID $PROJECT_NUMBER
```

```txt
my-bun-app-... [PROJECT_NUMBER]
```

</Step> 
<Step title="é“¾æ¥è®¡è´¹è´¦æˆ·">
åˆ—å‡ºæ‚¨å¯ç”¨çš„è®¡è´¹è´¦æˆ·å¹¶å°†å…¶é“¾æ¥åˆ°æ‚¨çš„é¡¹ç›®ï¼š

```bash terminal icon="terminal"
gcloud billing accounts list
```

```txt
ACCOUNT_ID            NAME                OPEN  MASTER_ACCOUNT_ID
[BILLING_ACCOUNT_ID]  My Billing Account  True
```

å°†æ‚¨çš„è®¡è´¹è´¦æˆ·é“¾æ¥åˆ°é¡¹ç›®ã€‚å°† `[BILLING_ACCOUNT_ID]` æ›¿æ¢ä¸ºæ‚¨çš„è®¡è´¹è´¦æˆ· IDã€‚

```bash terminal icon="terminal"
gcloud billing projects link $PROJECT_ID --billing-account=[BILLING_ACCOUNT_ID]
```

```txt
billingAccountName: billingAccounts/[BILLING_ACCOUNT_ID]
billingEnabled: true
name: projects/my-bun-app-.../billingInfo
projectId: my-bun-app-...
```

</Step> 
<Step title="å¯ç”¨ API å¹¶é…ç½® IAM è§’è‰²"> 
æ¿€æ´»å¿…è¦çš„æœåŠ¡å¹¶æˆäºˆ Cloud Build æƒé™ï¼š

```bash terminal icon="terminal"
gcloud services enable run.googleapis.com cloudbuild.googleapis.com
gcloud projects add-iam-policy-binding $PROJECT_ID \
  --member=serviceAccount:$PROJECT_NUMBER-compute@developer.gserviceaccount.com \
  --role=roles/run.builder
```

<Note>  
è¿™äº›å‘½ä»¤å¯ç”¨ Cloud Run (`run.googleapis.com`) å’Œ Cloud Build (`cloudbuild.googleapis.com`)ï¼Œè¿™æ˜¯ä»æºä»£ç éƒ¨ç½²æ‰€å¿…éœ€çš„ã€‚Cloud Run è¿è¡Œæ‚¨çš„å®¹å™¨åŒ–åº”ç”¨ç¨‹åºï¼Œè€Œ Cloud Build å¤„ç†æ„å»ºå’Œæ‰“åŒ…ã€‚

IAM ç»‘å®šæˆäºˆ Compute Engine æœåŠ¡è´¦æˆ· (`$PROJECT_NUMBER-compute@developer.gserviceaccount.com`) ä»£è¡¨æ‚¨æ„å»ºå’Œéƒ¨ç½²é•œåƒçš„æƒé™ã€‚

</Note>

</Step>
<Step title="æ·»åŠ  Dockerfile">
åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ [Dockerfile]ã€‚æ­¤æ–‡ä»¶åŒ…å«åˆå§‹åŒ–å®¹å™¨ã€å°†æœ¬åœ°é¡¹ç›®æ–‡ä»¶å¤åˆ¶åˆ°å…¶ä¸­ã€å®‰è£…ä¾èµ–é¡¹å¹¶å¯åŠ¨åº”ç”¨ç¨‹åºçš„æŒ‡ä»¤ã€‚

```docker Dockerfile icon="docker"
# ä½¿ç”¨å®˜æ–¹ Bun é•œåƒè¿è¡Œåº”ç”¨ç¨‹åº
FROM oven/bun:latest

# å°† package.json å’Œ bun.lock å¤åˆ¶åˆ°å®¹å™¨ä¸­
COPY package.json bun.lock ./

# å®‰è£…ä¾èµ–é¡¹
# å®‰è£…ä¾èµ–é¡¹
RUN bun install --production --frozen-lockfile

# å°†åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†å¤åˆ¶åˆ°å®¹å™¨ä¸­
COPY . .

# è¿è¡Œåº”ç”¨ç¨‹åº
CMD ["bun", "index.ts"]
```

<Note>
  ç¡®ä¿å¯åŠ¨å‘½ä»¤å¯¹åº”äºåº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚å¦‚æœæ‚¨çš„ [package.json] ä¸­æœ‰å¯åŠ¨è„šæœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯ `CMD ["bun", "run", "start"]`ã€‚

æ­¤é•œåƒåœ¨å®¹å™¨å†…ä½¿ç”¨ Bun å®‰è£…ä¾èµ–é¡¹å¹¶è¿è¡Œæ‚¨çš„åº”ç”¨ç¨‹åºã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæ²¡æœ‰ä¾èµ–é¡¹ï¼Œæ‚¨å¯ä»¥çœç•¥ `RUN bun install --production --frozen-lockfile` è¿™ä¸€è¡Œã€‚

</Note>

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ [.dockerignore] æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åŒ…å«åº”ä»å®¹å™¨é•œåƒä¸­_æ’é™¤_çš„æ–‡ä»¶å’Œç›®å½•ï¼Œä¾‹å¦‚ [node_modules]ã€‚è¿™ä½¿æ‚¨çš„æ„å»ºæ›´å¿«ã€æ›´å°ï¼š

```docker .dockerignore icon="Docker"
node_modules
Dockerfile*
.dockerignore
.git
.gitignore
README.md
LICENSE
.vscode
.env
# ä»»ä½•å…¶ä»–æ‚¨æƒ³è¦æ’é™¤çš„æ–‡ä»¶æˆ–ç›®å½•
```

</Step>
<Step title="éƒ¨ç½²æ‚¨çš„æœåŠ¡"> 
ç¡®ä¿æ‚¨åœ¨åŒ…å« [Dockerfile] çš„ç›®å½•ä¸­ï¼Œç„¶åä»æœ¬åœ°æºä»£ç ç›´æ¥éƒ¨ç½²ï¼š

<Note>
  æ›´æ–° `--region` æ ‡å¿—ä¸ºæ‚¨çš„é¦–é€‰åŒºåŸŸã€‚æ‚¨ä¹Ÿå¯ä»¥çœç•¥æ­¤æ ‡å¿—ä»¥è·å¾—äº¤äº’å¼æç¤ºæ¥é€‰æ‹©åŒºåŸŸã€‚
</Note>

```bash terminal icon="terminal"
gcloud run deploy my-bun-app --source . --region=us-west1 --allow-unauthenticated
```

```txt
Deploying from source requires an Artifact Registry Docker repository to store built containers. A repository named
[cloud-run-source-deploy] in region [us-west1] will be created.

Do you want to continue (Y/n)? Y

Building using Dockerfile and deploying container to Cloud Run service [my-bun-app] in project [my-bun-app-...] region [us-west1]
âœ“ Building and deploying... Done.
  âœ“ Validating Service...
  âœ“ Uploading sources...
  âœ“ Building Container... Logs are available at [https://console.cloud.google.com/cloud-build/builds...].
  âœ“ Creating Revision...
  âœ“ Routing traffic...
  âœ“ Setting IAM Policy...
Done.
Service [my-bun-app] revision [my-bun-app-...] has been deployed and is serving 100 percent of traffic.
Service URL: https://my-bun-app-....us-west1.run.app
```

</Step>
<Step title="è®¿é—®æ‚¨çš„å®æ—¶åº”ç”¨ç¨‹åº">

ğŸ‰ æ‚¨çš„ Bun åº”ç”¨ç¨‹åºç°åœ¨å·²ä¸Šçº¿ï¼

è®¿é—®æœåŠ¡ URL (`https://my-bun-app-....us-west1.run.app`) ä»¥ç¡®è®¤ä¸€åˆ‡æ­£å¸¸è¿è¡Œã€‚

</Step>
</Steps>
