var N=Symbol.for,z=globalThis[N("Bun.lazy")];if(!z||typeof z!=="function")throw new Error("Something went wrong while loading Bun. Expected 'Bun.lazy' to be defined.");var C=Object.defineProperties,T=Symbol.toStringTag,D=Function.prototype.apply,F=Array.isArray,k=ArrayBuffer.isView,R={SQLITE_OPEN_READONLY:1,SQLITE_OPEN_READWRITE:2,SQLITE_OPEN_CREATE:4,SQLITE_OPEN_DELETEONCLOSE:8,SQLITE_OPEN_EXCLUSIVE:16,SQLITE_OPEN_AUTOPROXY:32,SQLITE_OPEN_URI:64,SQLITE_OPEN_MEMORY:128,SQLITE_OPEN_MAIN_DB:256,SQLITE_OPEN_TEMP_DB:512,SQLITE_OPEN_TRANSIENT_DB:1024,SQLITE_OPEN_MAIN_JOURNAL:2048,SQLITE_OPEN_TEMP_JOURNAL:4096,SQLITE_OPEN_SUBJOURNAL:8192,SQLITE_OPEN_SUPER_JOURNAL:16384,SQLITE_OPEN_NOMUTEX:32768,SQLITE_OPEN_FULLMUTEX:65536,SQLITE_OPEN_SHAREDCACHE:131072,SQLITE_OPEN_PRIVATECACHE:262144,SQLITE_OPEN_WAL:524288,SQLITE_OPEN_NOFOLLOW:16777216,SQLITE_OPEN_EXRESCODE:33554432,SQLITE_PREPARE_PERSISTENT:1,SQLITE_PREPARE_NORMALIZE:2,SQLITE_PREPARE_NO_VTAB:4},$,K,x;class G{constructor(E){switch(this.#E=E,E.paramsCount){case 0:{this.get=this.#I,this.all=this.#_,this.values=this.#j,this.run=this.#B;break}default:{this.get=this.#H,this.all=this.#J,this.values=this.#M,this.run=this.#O;break}}}#E;get;all;values;run;isFinalized=!1;toJSON(){return{sql:this.native.toString(),isFinalized:this.isFinalized,paramsCount:this.paramsCount,columnNames:this.columnNames}}get[T](){return`"${this.native.toString()}"`}toString(){return this.native.toString()}get native(){return this.#E}#I(){return this.#E.get()}#_(){return this.#E.all()}#j(){return this.#E.values()}#B(){this.#E.run()}#H(...E){if(E.length===0)return this.#I();var I=E[0];return!F(I)&&(!I||typeof I!=="object"||k(I))?this.#E.get(E):this.#E.get(...E)}#J(...E){if(E.length===0)return this.#_();var I=E[0];return!F(I)&&(!I||typeof I!=="object"||k(I))?this.#E.all(E):this.#E.all(...E)}#M(...E){if(E.length===0)return this.#j();var I=E[0];return!F(I)&&(!I||typeof I!=="object"||k(I))?this.#E.values(E):this.#E.values(...E)}#O(...E){if(E.length===0)return this.#B();var I=E[0];!F(I)&&(!I||typeof I!=="object"||k(I))?this.#E.run(E):this.#E.run(...E)}get columnNames(){return this.#E.columns}get paramsCount(){return this.#E.paramsCount}finalize(...E){return this.isFinalized=!0,this.#E.finalize(...E)}}var v=N("Bun.Database.cache.count");class V{constructor(E,I){if(typeof E==="undefined");else if(typeof E!=="string"){if(k(E)){this.#E=V.deserialize(E,typeof I==="object"&&I?!!I.readonly:((I|0)&R.SQLITE_OPEN_READONLY)!=0),this.filename=":memory:";return}throw new TypeError(`Expected 'filename' to be a string, got '${typeof E}'`)}var _=typeof E==="string"?E.trim():":memory:",j=R.SQLITE_OPEN_READWRITE|R.SQLITE_OPEN_CREATE;if(typeof I==="object"&&I){if(j=0,I.readonly)j=R.SQLITE_OPEN_READONLY;if("readOnly"in I)throw new TypeError('Misspelled option "readOnly" should be "readonly"');if(I.create)j=R.SQLITE_OPEN_READWRITE|R.SQLITE_OPEN_CREATE;if(I.readwrite)j|=R.SQLITE_OPEN_READWRITE}else if(typeof I==="number")j=I;const B=_===""||_===":memory:";if(B&&(j&R.SQLITE_OPEN_READONLY)!==0)throw new Error("Cannot open an anonymous database in read-only mode.");if(!$)K=$=z("sqlite");this.#E=$.open(B?":memory:":_,j),this.filename=_}#E;#I=[];#_=[];#j=[];filename;get handle(){return this.#E}get inTransaction(){return $.isInTransaction(this.#E)}static open(E,I){return new V(E,I)}loadExtension(E,I){return $.loadExtension(this.#E,E,I)}serialize(E){return $.serialize(this.#E,E||"main")}static deserialize(E,I=!1){if(!$)K=$=z("sqlite");return $.deserialize(E,I)}static setCustomSQLite(E){if(!$)K=$=z("sqlite");return $.setCustomSQLite(E)}close(){return this.clearQueryCache(),$.close(this.#E)}clearQueryCache(){for(let E of this.#j)E.finalize();this.#I.length=0,this.#j.length=0,this.#_.length=0}run(E,...I){if(I.length===0){$.run(this.#E,E);return}var _=I[0];return!F(_)&&(!_||typeof _!=="object"||k(_))?$.run(this.#E,E,I):$.run(this.#E,E,...I)}prepare(E,I,_){return new G($.prepare(this.#E,E,I,_||0))}static MAX_QUERY_CACHE_SIZE=20;get[v](){return this.#I.length}query(E){if(typeof E!=="string")throw new TypeError(`Expected 'query' to be a string, got '${typeof E}'`);if(E.length===0)throw new Error("SQL query cannot be empty.");var I=this.#_.indexOf(E.length);while(I!==-1){if(this.#I[I]!==E){I=this.#_.indexOf(E.length,I+1);continue}var j=this.#j[I];if(j.isFinalized)return this.#j[I]=this.prepare(E,void 0,_?R.SQLITE_PREPARE_PERSISTENT:0);return j}const _=this.#I.length<V.MAX_QUERY_CACHE_SIZE;var j=this.prepare(E,void 0,_?R.SQLITE_PREPARE_PERSISTENT:0);if(_)this.#I.push(E),this.#_.push(E.length),this.#j.push(j);return j}transaction(E,I){if(typeof E!=="function")throw new TypeError("Expected first argument to be a function");const _=this,j=A(_,I),B={default:{value:P(E,_,j.default)},deferred:{value:P(E,_,j.deferred)},immediate:{value:P(E,_,j.immediate)},exclusive:{value:P(E,_,j.exclusive)},database:{value:this,enumerable:!0}};return C(B.default.value,B),C(B.deferred.value,B),C(B.immediate.value,B),C(B.exclusive.value,B),B.default.value}}V.prototype.exec=V.prototype.run;var A=(E,I)=>{let _=(x||=new WeakMap).get(E);if(!_){const j={commit:E.prepare("COMMIT",void 0,0),rollback:E.prepare("ROLLBACK",void 0,0),savepoint:E.prepare("SAVEPOINT `\t_bs3.\t`",void 0,0),release:E.prepare("RELEASE `\t_bs3.\t`",void 0,0),rollbackTo:E.prepare("ROLLBACK TO `\t_bs3.\t`",void 0,0)};x.set(E,_={default:Object.assign({begin:E.prepare("BEGIN",void 0,0)},j),deferred:Object.assign({begin:E.prepare("BEGIN DEFERRED",void 0,0)},j),immediate:Object.assign({begin:E.prepare("BEGIN IMMEDIATE",void 0,0)},j),exclusive:Object.assign({begin:E.prepare("BEGIN EXCLUSIVE",void 0,0)},j)})}return _},P=(E,I,{begin:_,commit:j,rollback:B,savepoint:H,release:J,rollbackTo:M})=>function O(...U){let W,X,Y;if(I.inTransaction)W=H,X=J,Y=M;else W=_,X=j,Y=B;try{W.run();const Z=E.apply(this,U);return X.run(),Z}catch(Z){if(I.inTransaction){if(Y.run(),Y!==B)X.run()}throw Z}};export{K as native,V as default,R as constants,G as Statement,V as Database};
