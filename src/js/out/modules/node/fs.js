var Aq=function(j,q){try{const x=j.apply(C,q.slice(0,q.length-1)),A=q[q.length-1];if(typeof A==="function")queueMicrotask(()=>A(null,x))}catch(x){const A=q[q.length-1];if(typeof A==="function")queueMicrotask(()=>A(x))}};function Jq(j,q){return new Hq(j,q)}function Lq(j,q){return new Kq(j,q)}var{direct:F,isPromise:O,isCallable:S}=import.meta.primordials,R=import.meta.require("node:fs/promises"),{Readable:f,NativeWritable:k,_getNativeReadableStreamPrototype:u,eos:m}=import.meta.require("node:stream"),b=u(2,f),C=Bun.fs(),w=process.env.DEBUG?console.log:()=>{},l=function j(...q){Aq(C.accessSync,q)},g=function j(...q){Aq(C.appendFileSync,q)},d=function j(...q){Aq(C.closeSync,q)},o=function j(...q){Aq(C.rmSync,q)},i=function j(...q){Aq(C.rmdirSync,q)},h=function j(...q){Aq(C.copyFileSync,q)},p=function j(...q){Aq(C.existsSync,q)},c=function j(...q){Aq(C.chownSync,q)},n=function j(...q){Aq(C.chmodSync,q)},s=function j(...q){Aq(C.fchmodSync,q)},t=function j(...q){Aq(C.fchownSync,q)},a=function j(...q){Aq(C.fstatSync,q)},e=function j(...q){Aq(C.fsyncSync,q)},r=function j(...q){Aq(C.ftruncateSync,q)},jj=function j(...q){Aq(C.futimesSync,q)},qj=function j(...q){Aq(C.lchmodSync,q)},xj=function j(...q){Aq(C.lchownSync,q)},Aj=function j(...q){Aq(C.linkSync,q)},Bj=function j(...q){Aq(C.lstatSync,q)},Ej=function j(...q){Aq(C.mkdirSync,q)},Gj=function j(...q){Aq(C.mkdtempSync,q)},Hj=function j(...q){Aq(C.openSync,q)},Jj=function j(...q){Aq(C.readSync,q)},Kj=function j(...q){Aq(C.writeSync,q)},Lj=function j(...q){Aq(C.readdirSync,q)},Nj=function j(...q){Aq(C.readFileSync,q)},Qj=function j(...q){Aq(C.writeFileSync,q)},Uj=function j(...q){Aq(C.readlinkSync,q)},P=function j(...q){Aq(C.realpathSync,q)},Vj=function j(...q){Aq(C.renameSync,q)},Xj=function j(...q){Aq(C.statSync,q)},Yj=function j(...q){Aq(C.symlinkSync,q)},Zj=function j(...q){Aq(C.truncateSync,q)},_j=function j(...q){Aq(C.unlinkSync,q)},$j=function j(...q){Aq(C.utimesSync,q)},Mj=function j(...q){Aq(C.lutimesSync,q)},zj=C.accessSync.bind(C),vj=C.appendFileSync.bind(C),wj=C.closeSync.bind(C),Dj=C.copyFileSync.bind(C),Cj=C.existsSync.bind(C),Pj=C.chownSync.bind(C),Ij=C.chmodSync.bind(C),Wj=C.fchmodSync.bind(C),Rj=C.fchownSync.bind(C),Tj=C.fstatSync.bind(C),yj=C.fsyncSync.bind(C),Fj=C.ftruncateSync.bind(C),Oj=C.futimesSync.bind(C),Sj=C.lchmodSync.bind(C),fj=C.lchownSync.bind(C),kj=C.linkSync.bind(C),uj=C.lstatSync.bind(C),mj=C.mkdirSync.bind(C),bj=C.mkdtempSync.bind(C),I=C.openSync.bind(C),lj=C.readSync.bind(C),gj=C.writeSync.bind(C),dj=C.readdirSync.bind(C),oj=C.readFileSync.bind(C),ij=C.writeFileSync.bind(C),hj=C.readlinkSync.bind(C),W=C.realpathSync.bind(C),pj=C.renameSync.bind(C),cj=C.statSync.bind(C),nj=C.symlinkSync.bind(C),sj=C.truncateSync.bind(C),tj=C.unlinkSync.bind(C),aj=C.utimesSync.bind(C),ej=C.lutimesSync.bind(C),rj=C.rmSync.bind(C),jq=C.rmdirSync.bind(C),qq=C.Dirent,xq=C.Stats,R=import.meta.require("node:fs/promises"),v=Symbol.for("Bun.Node.readStreamPathFastPath"),Bq=Symbol.for("Bun.NodeReadStream"),D=Symbol.for("Bun.NodeReadStreamPathOrFd"),Eq=Symbol.for("Bun.NodeWriteStream"),M=Symbol.for("Bun.NodeWriteStreamFastPath"),Gq=Symbol.for("Bun.NodeWriteStreamFastPathCall"),_=Symbol.for("kIoDone"),$={file:void 0,fd:void 0,flags:"r",encoding:void 0,mode:438,autoClose:!0,emitClose:!0,start:0,end:Infinity,highWaterMark:65536,fs:{read:Jj,open:(j,q,x,A)=>{var B;try{B=I(j,q,x)}catch(E){A(E);return}A(null,B)},openSync:I,close:d},autoDestroy:!0},T,Hq=function(j){return T=j,Object.defineProperty(T.prototype,Symbol.toStringTag,{value:"ReadStream",enumerable:!1}),Object.defineProperty(function q(x,A){return new j(x,A)},Symbol.hasInstance,{value(q){return q instanceof j}})}(class j extends b{constructor(q,x=$){if(typeof x!=="object"||!x)throw new TypeError("Expected options to be an object");var{flags:A=$.flags,encoding:B=$.encoding,mode:E=$.mode,autoClose:G=$.autoClose,emitClose:H=$.emitClose,start:J=$.start,end:K=$.end,autoDestroy:L=$.autoClose,fs:N=$.fs,highWaterMark:Q=$.highWaterMark}=x;if(q?.constructor?.name==="URL")q=Bun.fileURLToPath(q);var U={};if(typeof q==="string"){if(q.startsWith("file://"))q=Bun.fileURLToPath(q);if(q.length===0)throw new TypeError("Expected path to be a non-empty string");U.path=U.file=U[D]=q}else if(typeof q==="number"){if(q|=0,q<0)throw new TypeError("Expected fd to be a positive integer");U.fd=U[D]=q,U.autoClose=!1}else throw new TypeError("Expected a path or file descriptor");if(!U.fd)U.fd=N.openSync(q,A,E);var V=Bun.file(U.fd),X=V.stream(),Y=F(X);if(!Y)throw w("no native readable stream"),new Error("no native readable stream");var{stream:Z}=Y;super(Z,{...x,encoding:B,autoDestroy:L,autoClose:G,emitClose:H,highWaterMark:Q});if(Object.assign(this,U),this.#j=V,this.end=K,this._read=this.#A,this.start=J,this.flags=A,this.mode=E,this.emitClose=H,this[v]=J===0&&K===Infinity&&G&&N===$.fs&&(B==="buffer"||B==="binary"||B==null||B==="utf-8"||B==="utf8"),this._readableState.autoClose=L=G,this._readableState.highWaterMark=Q,J!==void 0)this.pos=J}#j;#q;file;path;fd=null;flags;mode;start;end;pos;bytesRead=0;#x=-1;_read;[Bq]=!0;[D];[v];_construct(q){if(super._construct)super._construct(q);else q();this.emit("open",this.fd),this.emit("ready")}_destroy(q,x){super._destroy(q,x);try{var A=this.fd;if(this[v]=!1,!A)x(q);else this.#q.close(A,(B)=>{x(B||q)}),this.fd=null}catch(B){throw B}}close(q){if(typeof q==="function")m()(this,q);this.destroy()}push(q){var x=q?.length??0;if(x>0){this.bytesRead+=x;var A=this.pos;if(A!==void 0){if(this.bytesRead<A)return!0;if(A===this.start){var B=this.bytesRead-A;q=q.slice(-B);var[E,...G]=arguments;if(this.pos=this.bytesRead,this.end&&this.bytesRead>=this.end)q=q.slice(0,this.end-this.start);return super.push(q,...G)}var H=this.end;if(H&&this.bytesRead>=H){q=q.slice(0,H-A);var[E,...G]=arguments;return this.pos=this.bytesRead,super.push(q,...G)}this.pos=this.bytesRead}}return super.push(...arguments)}#A(q){var{pos:x,end:A,bytesRead:B,fd:E,encoding:G}=this;if(q=x!==void 0?Math.min(A-x+1,q):Math.min(A-B+1,q),w("n @ fs.ReadStream.#internalRead, after clamp",q),q<=0){this.push(null);return}if(this.#x===-1&&B===0&&x===void 0){var H=Tj(E);if(this.#x=H.size,this.#x>0&&q>this.#x)q=this.#x+1;w("fileSize",this.#x)}this[_]=!1;var J=super._read(q);if(w("res -- undefined? why?",J),O(J)){var K=J?.then;if(K&&S(K))K(()=>{if(this[_]=!0,this.destroyed)this.emit(_)},(L)=>{this[_]=!0,this.#B(L)})}else if(this[_]=!0,this.destroyed)this.emit(_),this.#B(new Error("ERR_STREAM_PREMATURE_CLOSE"))}#B(q,x=null){var{_readableState:A={destroyed:!1,autoDestroy:!1},_writableState:B={destroyed:!1,autoDestroy:!1}}=this;if(B?.destroyed||A?.destroyed)return this;if(A?.autoDestroy||B?.autoDestroy)this.destroy(q);else if(q)this.emit("error",q)}pause(){return this[v]=!1,super.pause()}resume(){return this[v]=!1,super.resume()}unshift(...q){return this[v]=!1,super.unshift(...q)}pipe(q,x){if(this[v]&&(x?.end??!0)&&this._readableState?.pipes?.length===0){if((M in q)&&q[M]){if(q[Gq](this,x))return this}}return this[v]=!1,super.pipe(q,x)}}),z={fd:null,start:void 0,pos:void 0,encoding:void 0,flags:"w",mode:438,fs:{write:Kj,close:d,open:Hj,openSync:I}},y,Kq=function(j){return y=j,Object.defineProperty(y.prototype,Symbol.toStringTag,{value:"WritesStream",enumerable:!1}),Object.defineProperty(function q(x){return new j(x)},Symbol.hasInstance,{value(q){return q instanceof j}})}(class j extends k{constructor(q,x=z){if(!x)throw new TypeError("Expected options to be an object");var{fs:A=z.fs,start:B=z.start,flags:E=z.flags,mode:G=z.mode,autoClose:H=!0,emitClose:J=!1,autoDestroy:K=H,encoding:L=z.encoding,fd:N=z.fd,pos:Q=z.pos}=x,U={};if(typeof q==="string"){if(q.length===0)throw new TypeError("Expected a non-empty path");if(q.startsWith("file:"))q=Bun.fileURLToPath(q);U.path=q,U.fd=null,U[M]=H&&(B===void 0||B===0)&&A.write===z.fs.write&&A.close===z.fs.close}else U.fd=N,U[M]=!1;if(!U.fd)U.fd=A.openSync(q,E,G);super(U.fd,{...x,decodeStrings:!1,autoDestroy:K,emitClose:J,fd:U});if(Object.assign(this,U),typeof A?.write!=="function")throw new TypeError("Expected fs.write to be a function");if(typeof A?.close!=="function")throw new TypeError("Expected fs.close to be a function");if(typeof A?.open!=="function")throw new TypeError("Expected fs.open to be a function");if(typeof q==="object"&&q){if(q instanceof URL)q=Bun.fileURLToPath(q)}if(typeof q!=="string"&&typeof N!=="number")throw new TypeError("Expected a path or file descriptor");if(this.start=B,this.#j=A,this.flags=E,this.mode=G,this.start!==void 0)this.pos=this.start;if(L!==z.encoding){if(this.setDefaultEncoding(L),L!=="buffer"&&L!=="utf8"&&L!=="utf-8"&&L!=="binary")this[M]=!1}}get autoClose(){return this._writableState.autoDestroy}set autoClose(q){this._writableState.autoDestroy=q}destroySoon=this.end;open(){}path;fd;flags;mode;#j;bytesWritten=0;pos;[M];[Eq]=!0;start;[Gq](q,x){if(!this[M])return!1;if(this.fd!==null)return this[M]=!1,!1;return this[_]=!1,q[_]=!1,Bun.write(this[M],q[D]).then((A)=>{q[_]=this[_]=!0,this.bytesWritten+=A,q.bytesRead+=A,this.end(),q.close()},(A)=>{q[_]=this[_]=!0,this.#B(A),q.emit("error",A)})}isBunFastPathEnabled(){return this[M]}disableBunFastPath(){this[M]=!1}#q(q,x){if(q)return this.#B(q);this.bytesWritten+=x}#x(q,x){this[M]=!1;var A=this.fd;this.#j.close(A,(B)=>{this.fd=null,x(q||B)})}_construct(q){if(typeof this.fd==="number"){q();return}q(),this.emit("open",this.fd),this.emit("ready")}_destroy(q,x){if(this.fd===null)return x(q);if(this[_]){this.once(_,()=>this.#x(q,x));return}this.#x(q,x)}[_]=!1;close(q){if(q){if(this.closed){process.nextTick(q);return}this.on("close",q)}if(!this.autoClose)this.on("finish",this.destroy);this.end()}write(q,x=this._writableState.defaultEncoding,A){if(this[M]=!1,typeof q==="string")q=Buffer.from(q,x);var B=this.pos===void 0;return this[_]=!0,super.write(q,x,B?(E,G)=>{if(this[_]=!1,this.#q(E,G),this.emit(_),A)!E?A():A(E)}:()=>{},B)}#A(q,x,A){this.#j.write(this.fd,q,0,q.length,this.pos,(B,E)=>{this[_]=!1,this.#q(B,E),this.emit(_),!B?A():A(B)})}end(q,x,A){var B=this.pos===void 0;return super.end(q,x,A,B)}_write=this.#A;_writev=void 0;get pending(){return this.fd===null}_destroy(q,x){this.close(q,x)}#B(q){var{_readableState:x={destroyed:!1,autoDestroy:!1},_writableState:A={destroyed:!1,autoDestroy:!1}}=this;if(A?.destroyed||x?.destroyed)return this;if(x?.autoDestroy||A?.autoDestroy)this.destroy(q);else if(q)this.emit("error",q)}});Object.defineProperties(C,{createReadStream:{value:Jq},createWriteStream:{value:Lq},ReadStream:{value:Hq},WriteStream:{value:Kq}});P.native=P;W.native=W;var Nq={[Symbol.for("CommonJS")]:0,access:l,accessSync:zj,appendFile:g,appendFileSync:vj,chmod:n,chmodSync:Ij,chown:c,chownSync:Pj,close:d,closeSync:wj,constants:R.constants,copyFile:h,copyFileSync:Dj,createReadStream:Jq,createWriteStream:Lq,Dirent:qq,exists:p,existsSync:Cj,fchmod:s,fchmodSync:Wj,fchown:t,fchownSync:Rj,fstat:a,fstatSync:Tj,fsync:e,fsyncSync:yj,ftruncate:r,ftruncateSync:Fj,futimes:jj,futimesSync:Oj,lchmod:qj,lchmodSync:Sj,lchown:xj,lchownSync:fj,link:Aj,linkSync:kj,lstat:Bj,lstatSync:uj,lutimes:Mj,lutimesSync:ej,mkdir:Ej,mkdirSync:mj,mkdtemp:Gj,mkdtempSync:bj,open:Hj,openSync:I,promises:R,read:Jj,readFile:Nj,readFileSync:oj,readSync:lj,readdir:Lj,readdirSync:dj,readlink:Uj,readlinkSync:hj,realpath:P,realpathSync:W,rename:Vj,renameSync:pj,rm:o,rmSync:rj,rmdir:i,rmdirSync:jq,stat:Xj,statSync:cj,Stats:xq,symlink:Yj,symlinkSync:nj,truncate:Zj,truncateSync:sj,unlink:_j,unlinkSync:tj,utimes:$j,utimesSync:aj,write:Kj,writeFile:Qj,writeFileSync:ij,writeSync:gj,WriteStream:Kq,ReadStream:Hq,[Symbol.for("::bunternal::")]:{ReadStreamClass:T,WriteStreamClass:y}};export{gj as writeSync,ij as writeFileSync,Qj as writeFile,Kj as write,aj as utimesSync,$j as utimes,tj as unlinkSync,_j as unlink,sj as truncateSync,Zj as truncate,nj as symlinkSync,Yj as symlink,cj as statSync,Xj as stat,jq as rmdirSync,i as rmdir,rj as rmSync,o as rm,pj as renameSync,Vj as rename,W as realpathSync,P as realpath,hj as readlinkSync,Uj as readlink,dj as readdirSync,Lj as readdir,lj as readSync,oj as readFileSync,Nj as readFile,Jj as read,R as promises,I as openSync,Hj as open,bj as mkdtempSync,Gj as mkdtemp,mj as mkdirSync,Ej as mkdir,ej as lutimesSync,Mj as lutimes,uj as lstatSync,Bj as lstat,kj as linkSync,Aj as link,fj as lchownSync,xj as lchown,Sj as lchmodSync,qj as lchmod,Oj as futimesSync,jj as futimes,Fj as ftruncateSync,r as ftruncate,yj as fsyncSync,e as fsync,Tj as fstatSync,a as fstat,Rj as fchownSync,t as fchown,Wj as fchmodSync,s as fchmod,Cj as existsSync,p as exists,Nq as default,Lq as createWriteStream,Jq as createReadStream,Dj as copyFileSync,h as copyFile,wj as closeSync,d as close,Pj as chownSync,c as chown,Ij as chmodSync,n as chmod,vj as appendFileSync,g as appendFile,zj as accessSync,l as access,Kq as WriteStream,xq as Stats,Hq as ReadStream,qq as Dirent};
