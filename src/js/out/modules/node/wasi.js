var IW=constants,NW=Object.getOwnPropertyNames,YW=(W,A)=>function I(){return A||(0,W[NW(W)[0]])((A={exports:{}}).exports,A),A.exports},GW=YW({"node_modules/wasi-js/dist/types.js"(W){Object.defineProperty(W,"__esModule",{value:!0}),W.WASIKillError=W.WASIExitError=W.WASIError=void 0;var A=class extends Error{constructor(Y){super();this.errno=Y,Object.setPrototypeOf(this,A.prototype)}};W.WASIError=A;var I=class extends Error{constructor(Y){super(`WASI Exit error: ${Y}`);this.code=Y,Object.setPrototypeOf(this,I.prototype)}};W.WASIExitError=I;var N=class extends Error{constructor(Y){super(`WASI Kill signal: ${Y}`);this.signal=Y,Object.setPrototypeOf(this,N.prototype)}};W.WASIKillError=N}}),OW=YW({"node_modules/wasi-js/dist/constants.js"(W){Object.defineProperty(W,"__esModule",{value:!0}),W.WASI_ENOMSG=W.WASI_ENOMEM=W.WASI_ENOLINK=W.WASI_ENOLCK=W.WASI_ENOEXEC=W.WASI_ENOENT=W.WASI_ENODEV=W.WASI_ENOBUFS=W.WASI_ENFILE=W.WASI_ENETUNREACH=W.WASI_ENETRESET=W.WASI_ENETDOWN=W.WASI_ENAMETOOLONG=W.WASI_EMULTIHOP=W.WASI_EMSGSIZE=W.WASI_EMLINK=W.WASI_EMFILE=W.WASI_ELOOP=W.WASI_EISDIR=W.WASI_EISCONN=W.WASI_EIO=W.WASI_EINVAL=W.WASI_EINTR=W.WASI_EINPROGRESS=W.WASI_EILSEQ=W.WASI_EIDRM=W.WASI_EHOSTUNREACH=W.WASI_EFBIG=W.WASI_EFAULT=W.WASI_EEXIST=W.WASI_EDQUOT=W.WASI_EDOM=W.WASI_EDESTADDRREQ=W.WASI_EDEADLK=W.WASI_ECONNRESET=W.WASI_ECONNREFUSED=W.WASI_ECONNABORTED=W.WASI_ECHILD=W.WASI_ECANCELED=W.WASI_EBUSY=W.WASI_EBADMSG=W.WASI_EBADF=W.WASI_EALREADY=W.WASI_EAGAIN=W.WASI_EAFNOSUPPORT=W.WASI_EADDRNOTAVAIL=W.WASI_EADDRINUSE=W.WASI_EACCES=W.WASI_E2BIG=W.WASI_ESUCCESS=void 0,W.WASI_SIGVTALRM=W.WASI_SIGUSR2=W.WASI_SIGUSR1=W.WASI_SIGURG=W.WASI_SIGTTOU=W.WASI_SIGTTIN=W.WASI_SIGTSTP=W.WASI_SIGTRAP=W.WASI_SIGTERM=W.WASI_SIGSTOP=W.WASI_SIGSEGV=W.WASI_SIGQUIT=W.WASI_SIGPIPE=W.WASI_SIGKILL=W.WASI_SIGINT=W.WASI_SIGILL=W.WASI_SIGHUP=W.WASI_SIGFPE=W.WASI_SIGCONT=W.WASI_SIGCHLD=W.WASI_SIGBUS=W.WASI_SIGALRM=W.WASI_SIGABRT=W.WASI_ENOTCAPABLE=W.WASI_EXDEV=W.WASI_ETXTBSY=W.WASI_ETIMEDOUT=W.WASI_ESTALE=W.WASI_ESRCH=W.WASI_ESPIPE=W.WASI_EROFS=W.WASI_ERANGE=W.WASI_EPROTOTYPE=W.WASI_EPROTONOSUPPORT=W.WASI_EPROTO=W.WASI_EPIPE=W.WASI_EPERM=W.WASI_EOWNERDEAD=W.WASI_EOVERFLOW=W.WASI_ENXIO=W.WASI_ENOTTY=W.WASI_ENOTSUP=W.WASI_ENOTSOCK=W.WASI_ENOTRECOVERABLE=W.WASI_ENOTEMPTY=W.WASI_ENOTDIR=W.WASI_ENOTCONN=W.WASI_ENOSYS=W.WASI_ENOSPC=W.WASI_ENOPROTOOPT=void 0,W.RIGHTS_REGULAR_FILE_BASE=W.RIGHTS_CHARACTER_DEVICE_INHERITING=W.RIGHTS_CHARACTER_DEVICE_BASE=W.RIGHTS_BLOCK_DEVICE_INHERITING=W.RIGHTS_BLOCK_DEVICE_BASE=W.RIGHTS_ALL=W.WASI_RIGHT_SOCK_SHUTDOWN=W.WASI_RIGHT_POLL_FD_READWRITE=W.WASI_RIGHT_PATH_UNLINK_FILE=W.WASI_RIGHT_PATH_REMOVE_DIRECTORY=W.WASI_RIGHT_PATH_SYMLINK=W.WASI_RIGHT_FD_FILESTAT_SET_TIMES=W.WASI_RIGHT_FD_FILESTAT_SET_SIZE=W.WASI_RIGHT_FD_FILESTAT_GET=W.WASI_RIGHT_PATH_FILESTAT_SET_TIMES=W.WASI_RIGHT_PATH_FILESTAT_SET_SIZE=W.WASI_RIGHT_PATH_FILESTAT_GET=W.WASI_RIGHT_PATH_RENAME_TARGET=W.WASI_RIGHT_PATH_RENAME_SOURCE=W.WASI_RIGHT_PATH_READLINK=W.WASI_RIGHT_FD_READDIR=W.WASI_RIGHT_PATH_OPEN=W.WASI_RIGHT_PATH_LINK_TARGET=W.WASI_RIGHT_PATH_LINK_SOURCE=W.WASI_RIGHT_PATH_CREATE_FILE=W.WASI_RIGHT_PATH_CREATE_DIRECTORY=W.WASI_RIGHT_FD_ALLOCATE=W.WASI_RIGHT_FD_ADVISE=W.WASI_RIGHT_FD_WRITE=W.WASI_RIGHT_FD_TELL=W.WASI_RIGHT_FD_SYNC=W.WASI_RIGHT_FD_FDSTAT_SET_FLAGS=W.WASI_RIGHT_FD_SEEK=W.WASI_RIGHT_FD_READ=W.WASI_RIGHT_FD_DATASYNC=W.WASI_FDFLAG_SYNC=W.WASI_FDFLAG_RSYNC=W.WASI_FDFLAG_NONBLOCK=W.WASI_FDFLAG_DSYNC=W.WASI_FDFLAG_APPEND=W.WASI_FILETYPE_SYMBOLIC_LINK=W.WASI_FILETYPE_SOCKET_STREAM=W.WASI_FILETYPE_SOCKET_DGRAM=W.WASI_FILETYPE_REGULAR_FILE=W.WASI_FILETYPE_DIRECTORY=W.WASI_FILETYPE_CHARACTER_DEVICE=W.WASI_FILETYPE_BLOCK_DEVICE=W.WASI_FILETYPE_UNKNOWN=W.WASI_SIGXFSZ=W.WASI_SIGXCPU=void 0,W.SIGNAL_MAP=W.ERROR_MAP=W.WASI_WHENCE_END=W.WASI_WHENCE_CUR=W.WASI_WHENCE_SET=W.WASI_STDERR_FILENO=W.WASI_STDOUT_FILENO=W.WASI_STDIN_FILENO=W.WASI_DIRCOOKIE_START=W.WASI_PREOPENTYPE_DIR=W.WASI_O_TRUNC=W.WASI_O_EXCL=W.WASI_O_DIRECTORY=W.WASI_O_CREAT=W.WASI_FILESTAT_SET_MTIM_NOW=W.WASI_FILESTAT_SET_MTIM=W.WASI_FILESTAT_SET_ATIM_NOW=W.WASI_FILESTAT_SET_ATIM=W.WASI_EVENTTYPE_FD_WRITE=W.WASI_EVENTTYPE_FD_READ=W.WASI_EVENTTYPE_CLOCK=W.WASI_CLOCK_THREAD_CPUTIME_ID=W.WASI_CLOCK_PROCESS_CPUTIME_ID=W.WASI_CLOCK_MONOTONIC=W.WASI_CLOCK_REALTIME=W.RIGHTS_TTY_INHERITING=W.RIGHTS_TTY_BASE=W.RIGHTS_SOCKET_INHERITING=W.RIGHTS_SOCKET_BASE=W.RIGHTS_DIRECTORY_INHERITING=W.RIGHTS_DIRECTORY_BASE=W.RIGHTS_REGULAR_FILE_INHERITING=void 0,W.WASI_ESUCCESS=0,W.WASI_E2BIG=1,W.WASI_EACCES=2,W.WASI_EADDRINUSE=3,W.WASI_EADDRNOTAVAIL=4,W.WASI_EAFNOSUPPORT=5,W.WASI_EAGAIN=6,W.WASI_EALREADY=7,W.WASI_EBADF=8,W.WASI_EBADMSG=9,W.WASI_EBUSY=10,W.WASI_ECANCELED=11,W.WASI_ECHILD=12,W.WASI_ECONNABORTED=13,W.WASI_ECONNREFUSED=14,W.WASI_ECONNRESET=15,W.WASI_EDEADLK=16,W.WASI_EDESTADDRREQ=17,W.WASI_EDOM=18,W.WASI_EDQUOT=19,W.WASI_EEXIST=20,W.WASI_EFAULT=21,W.WASI_EFBIG=22,W.WASI_EHOSTUNREACH=23,W.WASI_EIDRM=24,W.WASI_EILSEQ=25,W.WASI_EINPROGRESS=26,W.WASI_EINTR=27,W.WASI_EINVAL=28,W.WASI_EIO=29,W.WASI_EISCONN=30,W.WASI_EISDIR=31,W.WASI_ELOOP=32,W.WASI_EMFILE=33,W.WASI_EMLINK=34,W.WASI_EMSGSIZE=35,W.WASI_EMULTIHOP=36,W.WASI_ENAMETOOLONG=37,W.WASI_ENETDOWN=38,W.WASI_ENETRESET=39,W.WASI_ENETUNREACH=40,W.WASI_ENFILE=41,W.WASI_ENOBUFS=42,W.WASI_ENODEV=43,W.WASI_ENOENT=44,W.WASI_ENOEXEC=45,W.WASI_ENOLCK=46,W.WASI_ENOLINK=47,W.WASI_ENOMEM=48,W.WASI_ENOMSG=49,W.WASI_ENOPROTOOPT=50,W.WASI_ENOSPC=51,W.WASI_ENOSYS=52,W.WASI_ENOTCONN=53,W.WASI_ENOTDIR=54,W.WASI_ENOTEMPTY=55,W.WASI_ENOTRECOVERABLE=56,W.WASI_ENOTSOCK=57,W.WASI_ENOTSUP=58,W.WASI_ENOTTY=59,W.WASI_ENXIO=60,W.WASI_EOVERFLOW=61,W.WASI_EOWNERDEAD=62,W.WASI_EPERM=63,W.WASI_EPIPE=64,W.WASI_EPROTO=65,W.WASI_EPROTONOSUPPORT=66,W.WASI_EPROTOTYPE=67,W.WASI_ERANGE=68,W.WASI_EROFS=69,W.WASI_ESPIPE=70,W.WASI_ESRCH=71,W.WASI_ESTALE=72,W.WASI_ETIMEDOUT=73,W.WASI_ETXTBSY=74,W.WASI_EXDEV=75,W.WASI_ENOTCAPABLE=76,W.WASI_SIGABRT=0,W.WASI_SIGALRM=1,W.WASI_SIGBUS=2,W.WASI_SIGCHLD=3,W.WASI_SIGCONT=4,W.WASI_SIGFPE=5,W.WASI_SIGHUP=6,W.WASI_SIGILL=7,W.WASI_SIGINT=8,W.WASI_SIGKILL=9,W.WASI_SIGPIPE=10,W.WASI_SIGQUIT=11,W.WASI_SIGSEGV=12,W.WASI_SIGSTOP=13,W.WASI_SIGTERM=14,W.WASI_SIGTRAP=15,W.WASI_SIGTSTP=16,W.WASI_SIGTTIN=17,W.WASI_SIGTTOU=18,W.WASI_SIGURG=19,W.WASI_SIGUSR1=20,W.WASI_SIGUSR2=21,W.WASI_SIGVTALRM=22,W.WASI_SIGXCPU=23,W.WASI_SIGXFSZ=24,W.WASI_FILETYPE_UNKNOWN=0,W.WASI_FILETYPE_BLOCK_DEVICE=1,W.WASI_FILETYPE_CHARACTER_DEVICE=2,W.WASI_FILETYPE_DIRECTORY=3,W.WASI_FILETYPE_REGULAR_FILE=4,W.WASI_FILETYPE_SOCKET_DGRAM=5,W.WASI_FILETYPE_SOCKET_STREAM=6,W.WASI_FILETYPE_SYMBOLIC_LINK=7,W.WASI_FDFLAG_APPEND=1,W.WASI_FDFLAG_DSYNC=2,W.WASI_FDFLAG_NONBLOCK=4,W.WASI_FDFLAG_RSYNC=8,W.WASI_FDFLAG_SYNC=16,W.WASI_RIGHT_FD_DATASYNC=BigInt(1),W.WASI_RIGHT_FD_READ=BigInt(2),W.WASI_RIGHT_FD_SEEK=BigInt(4),W.WASI_RIGHT_FD_FDSTAT_SET_FLAGS=BigInt(8),W.WASI_RIGHT_FD_SYNC=BigInt(16),W.WASI_RIGHT_FD_TELL=BigInt(32),W.WASI_RIGHT_FD_WRITE=BigInt(64),W.WASI_RIGHT_FD_ADVISE=BigInt(128),W.WASI_RIGHT_FD_ALLOCATE=BigInt(256),W.WASI_RIGHT_PATH_CREATE_DIRECTORY=BigInt(512),W.WASI_RIGHT_PATH_CREATE_FILE=BigInt(1024),W.WASI_RIGHT_PATH_LINK_SOURCE=BigInt(2048),W.WASI_RIGHT_PATH_LINK_TARGET=BigInt(4096),W.WASI_RIGHT_PATH_OPEN=BigInt(8192),W.WASI_RIGHT_FD_READDIR=BigInt(16384),W.WASI_RIGHT_PATH_READLINK=BigInt(32768),W.WASI_RIGHT_PATH_RENAME_SOURCE=BigInt(65536),W.WASI_RIGHT_PATH_RENAME_TARGET=BigInt(131072),W.WASI_RIGHT_PATH_FILESTAT_GET=BigInt(262144),W.WASI_RIGHT_PATH_FILESTAT_SET_SIZE=BigInt(524288),W.WASI_RIGHT_PATH_FILESTAT_SET_TIMES=BigInt(1048576),W.WASI_RIGHT_FD_FILESTAT_GET=BigInt(2097152),W.WASI_RIGHT_FD_FILESTAT_SET_SIZE=BigInt(4194304),W.WASI_RIGHT_FD_FILESTAT_SET_TIMES=BigInt(8388608),W.WASI_RIGHT_PATH_SYMLINK=BigInt(16777216),W.WASI_RIGHT_PATH_REMOVE_DIRECTORY=BigInt(33554432),W.WASI_RIGHT_PATH_UNLINK_FILE=BigInt(67108864),W.WASI_RIGHT_POLL_FD_READWRITE=BigInt(134217728),W.WASI_RIGHT_SOCK_SHUTDOWN=BigInt(268435456),W.RIGHTS_ALL=W.WASI_RIGHT_FD_DATASYNC|W.WASI_RIGHT_FD_READ|W.WASI_RIGHT_FD_SEEK|W.WASI_RIGHT_FD_FDSTAT_SET_FLAGS|W.WASI_RIGHT_FD_SYNC|W.WASI_RIGHT_FD_TELL|W.WASI_RIGHT_FD_WRITE|W.WASI_RIGHT_FD_ADVISE|W.WASI_RIGHT_FD_ALLOCATE|W.WASI_RIGHT_PATH_CREATE_DIRECTORY|W.WASI_RIGHT_PATH_CREATE_FILE|W.WASI_RIGHT_PATH_LINK_SOURCE|W.WASI_RIGHT_PATH_LINK_TARGET|W.WASI_RIGHT_PATH_OPEN|W.WASI_RIGHT_FD_READDIR|W.WASI_RIGHT_PATH_READLINK|W.WASI_RIGHT_PATH_RENAME_SOURCE|W.WASI_RIGHT_PATH_RENAME_TARGET|W.WASI_RIGHT_PATH_FILESTAT_GET|W.WASI_RIGHT_PATH_FILESTAT_SET_SIZE|W.WASI_RIGHT_PATH_FILESTAT_SET_TIMES|W.WASI_RIGHT_FD_FILESTAT_GET|W.WASI_RIGHT_FD_FILESTAT_SET_TIMES|W.WASI_RIGHT_FD_FILESTAT_SET_SIZE|W.WASI_RIGHT_PATH_SYMLINK|W.WASI_RIGHT_PATH_UNLINK_FILE|W.WASI_RIGHT_PATH_REMOVE_DIRECTORY|W.WASI_RIGHT_POLL_FD_READWRITE|W.WASI_RIGHT_SOCK_SHUTDOWN,W.RIGHTS_BLOCK_DEVICE_BASE=W.RIGHTS_ALL,W.RIGHTS_BLOCK_DEVICE_INHERITING=W.RIGHTS_ALL,W.RIGHTS_CHARACTER_DEVICE_BASE=W.RIGHTS_ALL,W.RIGHTS_CHARACTER_DEVICE_INHERITING=W.RIGHTS_ALL,W.RIGHTS_REGULAR_FILE_BASE=W.WASI_RIGHT_FD_DATASYNC|W.WASI_RIGHT_FD_READ|W.WASI_RIGHT_FD_SEEK|W.WASI_RIGHT_FD_FDSTAT_SET_FLAGS|W.WASI_RIGHT_FD_SYNC|W.WASI_RIGHT_FD_TELL|W.WASI_RIGHT_FD_WRITE|W.WASI_RIGHT_FD_ADVISE|W.WASI_RIGHT_FD_ALLOCATE|W.WASI_RIGHT_FD_FILESTAT_GET|W.WASI_RIGHT_FD_FILESTAT_SET_SIZE|W.WASI_RIGHT_FD_FILESTAT_SET_TIMES|W.WASI_RIGHT_POLL_FD_READWRITE,W.RIGHTS_REGULAR_FILE_INHERITING=BigInt(0),W.RIGHTS_DIRECTORY_BASE=W.WASI_RIGHT_FD_FDSTAT_SET_FLAGS|W.WASI_RIGHT_FD_SYNC|W.WASI_RIGHT_FD_ADVISE|W.WASI_RIGHT_PATH_CREATE_DIRECTORY|W.WASI_RIGHT_PATH_CREATE_FILE|W.WASI_RIGHT_PATH_LINK_SOURCE|W.WASI_RIGHT_PATH_LINK_TARGET|W.WASI_RIGHT_PATH_OPEN|W.WASI_RIGHT_FD_READDIR|W.WASI_RIGHT_PATH_READLINK|W.WASI_RIGHT_PATH_RENAME_SOURCE|W.WASI_RIGHT_PATH_RENAME_TARGET|W.WASI_RIGHT_PATH_FILESTAT_GET|W.WASI_RIGHT_PATH_FILESTAT_SET_SIZE|W.WASI_RIGHT_PATH_FILESTAT_SET_TIMES|W.WASI_RIGHT_FD_FILESTAT_GET|W.WASI_RIGHT_FD_FILESTAT_SET_TIMES|W.WASI_RIGHT_PATH_SYMLINK|W.WASI_RIGHT_PATH_UNLINK_FILE|W.WASI_RIGHT_PATH_REMOVE_DIRECTORY|W.WASI_RIGHT_POLL_FD_READWRITE,W.RIGHTS_DIRECTORY_INHERITING=W.RIGHTS_DIRECTORY_BASE|W.RIGHTS_REGULAR_FILE_BASE,W.RIGHTS_SOCKET_BASE=W.WASI_RIGHT_FD_READ|W.WASI_RIGHT_FD_FDSTAT_SET_FLAGS|W.WASI_RIGHT_FD_WRITE|W.WASI_RIGHT_FD_FILESTAT_GET|W.WASI_RIGHT_POLL_FD_READWRITE|W.WASI_RIGHT_SOCK_SHUTDOWN,W.RIGHTS_SOCKET_INHERITING=W.RIGHTS_ALL,W.RIGHTS_TTY_BASE=W.WASI_RIGHT_FD_READ|W.WASI_RIGHT_FD_FDSTAT_SET_FLAGS|W.WASI_RIGHT_FD_WRITE|W.WASI_RIGHT_FD_FILESTAT_GET|W.WASI_RIGHT_POLL_FD_READWRITE,W.RIGHTS_TTY_INHERITING=BigInt(0),W.WASI_CLOCK_REALTIME=0,W.WASI_CLOCK_MONOTONIC=1,W.WASI_CLOCK_PROCESS_CPUTIME_ID=2,W.WASI_CLOCK_THREAD_CPUTIME_ID=3,W.WASI_EVENTTYPE_CLOCK=0,W.WASI_EVENTTYPE_FD_READ=1,W.WASI_EVENTTYPE_FD_WRITE=2,W.WASI_FILESTAT_SET_ATIM=1<<0,W.WASI_FILESTAT_SET_ATIM_NOW=1<<1,W.WASI_FILESTAT_SET_MTIM=1<<2,W.WASI_FILESTAT_SET_MTIM_NOW=1<<3,W.WASI_O_CREAT=1<<0,W.WASI_O_DIRECTORY=1<<1,W.WASI_O_EXCL=1<<2,W.WASI_O_TRUNC=1<<3,W.WASI_PREOPENTYPE_DIR=0,W.WASI_DIRCOOKIE_START=0,W.WASI_STDIN_FILENO=0,W.WASI_STDOUT_FILENO=1,W.WASI_STDERR_FILENO=2,W.WASI_WHENCE_SET=0,W.WASI_WHENCE_CUR=1,W.WASI_WHENCE_END=2,W.ERROR_MAP={E2BIG:W.WASI_E2BIG,EACCES:W.WASI_EACCES,EADDRINUSE:W.WASI_EADDRINUSE,EADDRNOTAVAIL:W.WASI_EADDRNOTAVAIL,EAFNOSUPPORT:W.WASI_EAFNOSUPPORT,EALREADY:W.WASI_EALREADY,EAGAIN:W.WASI_EAGAIN,EBADF:W.WASI_EBADF,EBADMSG:W.WASI_EBADMSG,EBUSY:W.WASI_EBUSY,ECANCELED:W.WASI_ECANCELED,ECHILD:W.WASI_ECHILD,ECONNABORTED:W.WASI_ECONNABORTED,ECONNREFUSED:W.WASI_ECONNREFUSED,ECONNRESET:W.WASI_ECONNRESET,EDEADLOCK:W.WASI_EDEADLK,EDESTADDRREQ:W.WASI_EDESTADDRREQ,EDOM:W.WASI_EDOM,EDQUOT:W.WASI_EDQUOT,EEXIST:W.WASI_EEXIST,EFAULT:W.WASI_EFAULT,EFBIG:W.WASI_EFBIG,EHOSTDOWN:W.WASI_EHOSTUNREACH,EHOSTUNREACH:W.WASI_EHOSTUNREACH,EIDRM:W.WASI_EIDRM,EILSEQ:W.WASI_EILSEQ,EINPROGRESS:W.WASI_EINPROGRESS,EINTR:W.WASI_EINTR,EINVAL:W.WASI_EINVAL,EIO:W.WASI_EIO,EISCONN:W.WASI_EISCONN,EISDIR:W.WASI_EISDIR,ELOOP:W.WASI_ELOOP,EMFILE:W.WASI_EMFILE,EMLINK:W.WASI_EMLINK,EMSGSIZE:W.WASI_EMSGSIZE,EMULTIHOP:W.WASI_EMULTIHOP,ENAMETOOLONG:W.WASI_ENAMETOOLONG,ENETDOWN:W.WASI_ENETDOWN,ENETRESET:W.WASI_ENETRESET,ENETUNREACH:W.WASI_ENETUNREACH,ENFILE:W.WASI_ENFILE,ENOBUFS:W.WASI_ENOBUFS,ENODEV:W.WASI_ENODEV,ENOENT:W.WASI_ENOENT,ENOEXEC:W.WASI_ENOEXEC,ENOLCK:W.WASI_ENOLCK,ENOLINK:W.WASI_ENOLINK,ENOMEM:W.WASI_ENOMEM,ENOMSG:W.WASI_ENOMSG,ENOPROTOOPT:W.WASI_ENOPROTOOPT,ENOSPC:W.WASI_ENOSPC,ENOSYS:W.WASI_ENOSYS,ENOTCONN:W.WASI_ENOTCONN,ENOTDIR:W.WASI_ENOTDIR,ENOTEMPTY:W.WASI_ENOTEMPTY,ENOTRECOVERABLE:W.WASI_ENOTRECOVERABLE,ENOTSOCK:W.WASI_ENOTSOCK,ENOTTY:W.WASI_ENOTTY,ENXIO:W.WASI_ENXIO,EOVERFLOW:W.WASI_EOVERFLOW,EOWNERDEAD:W.WASI_EOWNERDEAD,EPERM:W.WASI_EPERM,EPIPE:W.WASI_EPIPE,EPROTO:W.WASI_EPROTO,EPROTONOSUPPORT:W.WASI_EPROTONOSUPPORT,EPROTOTYPE:W.WASI_EPROTOTYPE,ERANGE:W.WASI_ERANGE,EROFS:W.WASI_EROFS,ESPIPE:W.WASI_ESPIPE,ESRCH:W.WASI_ESRCH,ESTALE:W.WASI_ESTALE,ETIMEDOUT:W.WASI_ETIMEDOUT,ETXTBSY:W.WASI_ETXTBSY,EXDEV:W.WASI_EXDEV},W.SIGNAL_MAP={[W.WASI_SIGHUP]:"SIGHUP",[W.WASI_SIGINT]:"SIGINT",[W.WASI_SIGQUIT]:"SIGQUIT",[W.WASI_SIGILL]:"SIGILL",[W.WASI_SIGTRAP]:"SIGTRAP",[W.WASI_SIGABRT]:"SIGABRT",[W.WASI_SIGBUS]:"SIGBUS",[W.WASI_SIGFPE]:"SIGFPE",[W.WASI_SIGKILL]:"SIGKILL",[W.WASI_SIGUSR1]:"SIGUSR1",[W.WASI_SIGSEGV]:"SIGSEGV",[W.WASI_SIGUSR2]:"SIGUSR2",[W.WASI_SIGPIPE]:"SIGPIPE",[W.WASI_SIGALRM]:"SIGALRM",[W.WASI_SIGTERM]:"SIGTERM",[W.WASI_SIGCHLD]:"SIGCHLD",[W.WASI_SIGCONT]:"SIGCONT",[W.WASI_SIGSTOP]:"SIGSTOP",[W.WASI_SIGTSTP]:"SIGTSTP",[W.WASI_SIGTTIN]:"SIGTTIN",[W.WASI_SIGTTOU]:"SIGTTOU",[W.WASI_SIGURG]:"SIGURG",[W.WASI_SIGXCPU]:"SIGXCPU",[W.WASI_SIGXFSZ]:"SIGXFSZ",[W.WASI_SIGVTALRM]:"SIGVTALRM"}}}),jW=YW({"node_modules/wasi-js/dist/wasi.js"(W){var A=W&&W.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};let I;Object.defineProperty(W,"__esModule",{value:!0}),W.SOCKET_DEFAULT_RIGHTS=void 0;var N=()=>{},Y=()=>{},G=32768,O=GW(),j=OW(),Q=j.WASI_RIGHT_FD_DATASYNC|j.WASI_RIGHT_FD_READ|j.WASI_RIGHT_FD_SYNC|j.WASI_RIGHT_FD_ADVISE|j.WASI_RIGHT_FD_FILESTAT_GET|j.WASI_RIGHT_POLL_FD_READWRITE,V=j.WASI_RIGHT_FD_DATASYNC|j.WASI_RIGHT_FD_WRITE|j.WASI_RIGHT_FD_SYNC|j.WASI_RIGHT_FD_ADVISE|j.WASI_RIGHT_FD_FILESTAT_GET|j.WASI_RIGHT_POLL_FD_READWRITE,$=V;W.SOCKET_DEFAULT_RIGHTS=j.WASI_RIGHT_FD_DATASYNC|j.WASI_RIGHT_FD_READ|j.WASI_RIGHT_FD_WRITE|j.WASI_RIGHT_FD_ADVISE|j.WASI_RIGHT_FD_FILESTAT_GET|j.WASI_RIGHT_POLL_FD_READWRITE|j.WASI_RIGHT_FD_FDSTAT_SET_FLAGS;var X=(R)=>{const T=Math.trunc(R),k=BigInt(Math.round((R-T)*1e6));return BigInt(T)*BigInt(1e6)+k},Z=(R)=>{if(typeof R==="number")R=Math.trunc(R);const T=BigInt(R);return Number(T/BigInt(1e6))},q=(R)=>(...T)=>{try{return R(...T)}catch(k){let B=k;while(B.prev!=null)B=B.prev;if(B?.code&&typeof B?.code==="string")return j.ERROR_MAP[B.code]||j.WASI_EINVAL;if(B instanceof O.WASIError)return B.errno;throw B}},J=(R,T)=>{const k=R.FD_MAP.get(T);if(!k)throw new O.WASIError(j.WASI_EBADF);if(k.filetype===void 0){const B=R.fstatSync(k.real),{filetype:H,rightsBase:D,rightsInheriting:K}=M(R,T,B);if(k.filetype=H,!k.rights)k.rights={base:D,inheriting:K}}return k},M=(R,T,k)=>{switch(!0){case k.isBlockDevice():return{filetype:j.WASI_FILETYPE_BLOCK_DEVICE,rightsBase:j.RIGHTS_BLOCK_DEVICE_BASE,rightsInheriting:j.RIGHTS_BLOCK_DEVICE_INHERITING};case k.isCharacterDevice():{const B=j.WASI_FILETYPE_CHARACTER_DEVICE;if(T!==void 0&&R.bindings.isTTY(T))return{filetype:B,rightsBase:j.RIGHTS_TTY_BASE,rightsInheriting:j.RIGHTS_TTY_INHERITING};return{filetype:B,rightsBase:j.RIGHTS_CHARACTER_DEVICE_BASE,rightsInheriting:j.RIGHTS_CHARACTER_DEVICE_INHERITING}}case k.isDirectory():return{filetype:j.WASI_FILETYPE_DIRECTORY,rightsBase:j.RIGHTS_DIRECTORY_BASE,rightsInheriting:j.RIGHTS_DIRECTORY_INHERITING};case k.isFIFO():return{filetype:j.WASI_FILETYPE_SOCKET_STREAM,rightsBase:j.RIGHTS_SOCKET_BASE,rightsInheriting:j.RIGHTS_SOCKET_INHERITING};case k.isFile():return{filetype:j.WASI_FILETYPE_REGULAR_FILE,rightsBase:j.RIGHTS_REGULAR_FILE_BASE,rightsInheriting:j.RIGHTS_REGULAR_FILE_INHERITING};case k.isSocket():return{filetype:j.WASI_FILETYPE_SOCKET_STREAM,rightsBase:j.RIGHTS_SOCKET_BASE,rightsInheriting:j.RIGHTS_SOCKET_INHERITING};case k.isSymbolicLink():return{filetype:j.WASI_FILETYPE_SYMBOLIC_LINK,rightsBase:BigInt(0),rightsInheriting:BigInt(0)};default:return{filetype:j.WASI_FILETYPE_UNKNOWN,rightsBase:BigInt(0),rightsInheriting:BigInt(0)}}},U=!1,E;function S(){if(E)return E;const R={hrtime:()=>process.hrtime.bigint(),exit:(T)=>{process.exit(T)},kill:(T)=>{process.kill(process.pid,T)},randomFillSync:(T)=>crypto.getRandomValues(T),isTTY:(T)=>import.meta.require("node:tty").isatty(T),fs:Bun.fs(),path:import.meta.require("node:path")};return E={args:[],env:{},preopens:{},bindings:R,sleep:(T)=>{Bun.sleepSync(T)}}}var z=class R{constructor(T={}){const k=S();this.lastStdin=0,this.sleep=T.sleep||k.sleep,this.getStdin=T.getStdin,this.sendStdout=T.sendStdout,this.sendStderr=T.sendStderr;let B=T.preopens??k.preopens;this.env=T.env??k.env;const H=T.args??k.args;this.memory=void 0,this.view=void 0,this.bindings=T.bindings||k.bindings;const D=this.bindings;I=D.fs,this.FD_MAP=new Map([[j.WASI_STDIN_FILENO,{real:0,filetype:j.WASI_FILETYPE_CHARACTER_DEVICE,rights:{base:Q,inheriting:BigInt(0)},path:"/dev/stdin"}],[j.WASI_STDOUT_FILENO,{real:1,filetype:j.WASI_FILETYPE_CHARACTER_DEVICE,rights:{base:V,inheriting:BigInt(0)},path:"/dev/stdout"}],[j.WASI_STDERR_FILENO,{real:2,filetype:j.WASI_FILETYPE_CHARACTER_DEVICE,rights:{base:$,inheriting:BigInt(0)},path:"/dev/stderr"}]]);const K=D.path;for(let[h,w]of Object.entries(B)){const m=I.openSync(w,IW.O_RDONLY),P=this.getUnusedFileDescriptor();this.FD_MAP.set(P,{real:m,filetype:j.WASI_FILETYPE_DIRECTORY,rights:{base:j.RIGHTS_DIRECTORY_BASE,inheriting:j.RIGHTS_DIRECTORY_INHERITING},fakePath:h,path:w})}const y=(h,w)=>{this.refreshMemory();const{view:m,memory:P}=this,{buffer:b}=P,{byteLength:g}=b;if(w===1){const d=h,u=m.getUint32(d,!0);let _=m.getUint32(d+4,!0);if(_>g-u)console.log({buf:u,bufLen:_,total_memory:g}),N("getiovs: warning -- truncating buffer to fit in memory"),_=Math.min(_,Math.max(0,g-u));try{return[new Uint8Array(b,u,_)]}catch(c){throw console.warn("WASI.getiovs -- invalid buffer",c),new O.WASIError(j.WASI_EINVAL)}}const l=[];l.length=w;for(let d=0,u=h;d<w;d++,u+=8){const _=m.getUint32(u,!0);let c=m.getUint32(u+4,!0);if(c>g-_)console.log({buf:_,bufLen:c,total_memory:g}),N("getiovs: warning -- truncating buffer to fit in memory"),c=Math.min(c,Math.max(0,g-_));try{l[d]=new Uint8Array(b,_,c)}catch(i){throw console.warn("WASI.getiovs -- invalid buffer",i),new O.WASIError(j.WASI_EINVAL)}}return l},L=(h,w)=>{const m=J(this,h);if(w!==BigInt(0)&&(m.rights.base&w)===BigInt(0))throw new O.WASIError(j.WASI_EPERM);return m},F=Bun.nanoseconds(),v=Math.trunc(performance.timeOrigin*1e6),C=(h)=>{switch(h){case j.WASI_CLOCK_MONOTONIC:return Bun.nanoseconds();case j.WASI_CLOCK_REALTIME:return Bun.nanoseconds()+v;case j.WASI_CLOCK_PROCESS_CPUTIME_ID:case j.WASI_CLOCK_THREAD_CPUTIME_ID:return Bun.nanoseconds()-F;default:return null}};if(this.wasiImport={args_get:(h,w)=>{this.refreshMemory();let m=h,P=w;return H.forEach((b)=>{this.view.setUint32(m,P,!0),m+=4,P+=Buffer.from(this.memory.buffer).write(`${b}\0`,P)}),j.WASI_ESUCCESS},args_sizes_get:(h,w)=>{this.refreshMemory(),this.view.setUint32(h,H.length,!0);const m=H.reduce((P,b)=>P+Buffer.byteLength(b)+1,0);return this.view.setUint32(w,m,!0),j.WASI_ESUCCESS},environ_get:(h,w)=>{this.refreshMemory();let m=h,P=w;return Object.entries(this.env).forEach(([b,g])=>{this.view.setUint32(m,P,!0),m+=4,P+=Buffer.from(this.memory.buffer).write(`${b}=${g}\0`,P)}),j.WASI_ESUCCESS},environ_sizes_get:(h,w)=>{this.refreshMemory();const m=Object.entries(this.env).map(([b,g])=>`${b}=${g}\0`),P=m.reduce((b,g)=>b+Buffer.byteLength(g),0);return this.view.setUint32(h,m.length,!0),this.view.setUint32(w,P,!0),j.WASI_ESUCCESS},clock_res_get:(h,w)=>{let m;switch(h){case j.WASI_CLOCK_MONOTONIC:case j.WASI_CLOCK_PROCESS_CPUTIME_ID:case j.WASI_CLOCK_THREAD_CPUTIME_ID:{m=BigInt(1);break}case j.WASI_CLOCK_REALTIME:{m=BigInt(1000);break}}if(!m)throw Error("invalid clockId");return this.view.setBigUint64(w,m),j.WASI_ESUCCESS},clock_time_get:(h,w,m)=>{this.refreshMemory();const P=C(h);if(P===null)return j.WASI_EINVAL;return this.view.setBigUint64(m,BigInt(P),!0),j.WASI_ESUCCESS},fd_advise:q((h,w,m,P)=>{return L(h,j.WASI_RIGHT_FD_ADVISE),j.WASI_ENOSYS}),fd_allocate:q((h,w,m)=>{return L(h,j.WASI_RIGHT_FD_ALLOCATE),j.WASI_ENOSYS}),fd_close:q((h)=>{const w=L(h,BigInt(0));return I.closeSync(w.real),this.FD_MAP.delete(h),j.WASI_ESUCCESS}),fd_datasync:q((h)=>{const w=L(h,j.WASI_RIGHT_FD_DATASYNC);return I.fdatasyncSync(w.real),j.WASI_ESUCCESS}),fd_fdstat_get:q((h,w)=>{const m=L(h,BigInt(0));if(this.refreshMemory(),m.filetype==null)throw Error("stats.filetype must be set");return this.view.setUint8(w,m.filetype),this.view.setUint16(w+2,0,!0),this.view.setUint16(w+4,0,!0),this.view.setBigUint64(w+8,BigInt(m.rights.base),!0),this.view.setBigUint64(w+8+8,BigInt(m.rights.inheriting),!0),j.WASI_ESUCCESS}),fd_fdstat_set_flags:q((h,w)=>{if(L(h,j.WASI_RIGHT_FD_FDSTAT_SET_FLAGS),this.wasiImport.sock_fcntlSetFlags(h,w)==0)return j.WASI_ESUCCESS;return j.WASI_ENOSYS}),fd_fdstat_set_rights:q((h,w,m)=>{const P=L(h,BigInt(0));if((P.rights.base|w)>P.rights.base)return j.WASI_EPERM;if((P.rights.inheriting|m)>P.rights.inheriting)return j.WASI_EPERM;return P.rights.base=w,P.rights.inheriting=m,j.WASI_ESUCCESS}),fd_filestat_get:q((h,w)=>{const m=L(h,j.WASI_RIGHT_FD_FILESTAT_GET),P=this.fstatSync(m.real);if(this.refreshMemory(),this.view.setBigUint64(w,BigInt(P.dev),!0),w+=8,this.view.setBigUint64(w,BigInt(P.ino),!0),w+=8,m.filetype==null)throw Error("stats.filetype must be set");return this.view.setUint8(w,m.filetype),w+=8,this.view.setBigUint64(w,BigInt(P.nlink),!0),w+=8,this.view.setBigUint64(w,BigInt(P.size),!0),w+=8,this.view.setBigUint64(w,X(P.atimeMs),!0),w+=8,this.view.setBigUint64(w,X(P.mtimeMs),!0),w+=8,this.view.setBigUint64(w,X(P.ctimeMs),!0),j.WASI_ESUCCESS}),fd_filestat_set_size:q((h,w)=>{const m=L(h,j.WASI_RIGHT_FD_FILESTAT_SET_SIZE);return I.ftruncateSync(m.real,Number(w)),j.WASI_ESUCCESS}),fd_filestat_set_times:q((h,w,m,P)=>{const b=L(h,j.WASI_RIGHT_FD_FILESTAT_SET_TIMES),g=this.fstatSync(b.real);let{atime:l,mtime:d}=g;const u=Z(C(j.WASI_CLOCK_REALTIME)),_=j.WASI_FILESTAT_SET_ATIM|j.WASI_FILESTAT_SET_ATIM_NOW;if((P&_)===_)return j.WASI_EINVAL;const c=j.WASI_FILESTAT_SET_MTIM|j.WASI_FILESTAT_SET_MTIM_NOW;if((P&c)===c)return j.WASI_EINVAL;if((P&j.WASI_FILESTAT_SET_ATIM)===j.WASI_FILESTAT_SET_ATIM)l=Z(w);else if((P&j.WASI_FILESTAT_SET_ATIM_NOW)===j.WASI_FILESTAT_SET_ATIM_NOW)l=u;if((P&j.WASI_FILESTAT_SET_MTIM)===j.WASI_FILESTAT_SET_MTIM)d=Z(m);else if((P&j.WASI_FILESTAT_SET_MTIM_NOW)===j.WASI_FILESTAT_SET_MTIM_NOW)d=u;return I.futimesSync(b.real,new Date(l),new Date(d)),j.WASI_ESUCCESS}),fd_prestat_get:q((h,w)=>{const m=L(h,BigInt(0));return this.refreshMemory(),this.view.setUint8(w,j.WASI_PREOPENTYPE_DIR),this.view.setUint32(w+4,Buffer.byteLength(m.fakePath??m.path??""),!0),j.WASI_ESUCCESS}),fd_prestat_dir_name:q((h,w,m)=>{const P=L(h,BigInt(0));return this.refreshMemory(),Buffer.from(this.memory.buffer).write(P.fakePath??P.path??"",w,m,"utf8"),j.WASI_ESUCCESS}),fd_pwrite:q((h,w,m,P,b)=>{const g=L(h,j.WASI_RIGHT_FD_WRITE|j.WASI_RIGHT_FD_SEEK);let l=0;return y(w,m).forEach((d)=>{let u=0;while(u<d.byteLength)u+=I.writeSync(g.real,d,u,d.byteLength-u,Number(P)+l+u);l+=u}),this.view.setUint32(b,l,!0),j.WASI_ESUCCESS}),fd_write:q((h,w,m,P)=>{const b=L(h,j.WASI_RIGHT_FD_WRITE),g=h==j.WASI_STDOUT_FILENO,l=h==j.WASI_STDERR_FILENO;let d=0;return y(w,m).forEach((u)=>{if(u.byteLength==0)return;if(g&&this.sendStdout!=null)this.sendStdout(u),d+=u.byteLength;else if(l&&this.sendStderr!=null)this.sendStderr(u),d+=u.byteLength;else{let _=0;while(_<u.byteLength){const c=I.writeSync(b.real,u,_,u.byteLength-_,b.offset?Number(b.offset):null);if(b.offset)b.offset+=BigInt(c);_+=c}d+=_}}),this.view.setUint32(P,d,!0),j.WASI_ESUCCESS}),fd_pread:q((h,w,m,P,b)=>{const g=L(h,j.WASI_RIGHT_FD_READ|j.WASI_RIGHT_FD_SEEK);let l=0;W:for(let d of y(w,m)){let u=0;while(u<d.byteLength){const _=d.byteLength-u,c=I.readSync(g.real,d,u,d.byteLength-u,Number(P)+l+u);if(u+=c,l+=c,c===0||c<_)break W}l+=u}return this.view.setUint32(b,l,!0),j.WASI_ESUCCESS}),fd_read:q((h,w,m,P)=>{const b=L(h,j.WASI_RIGHT_FD_READ),g=h==j.WASI_STDIN_FILENO;let l=0;W:for(let d of y(w,m)){let u=0;while(u<d.byteLength){let _=d.byteLength-u,c=g||b.offset===void 0?null:Number(b.offset),i=0;if(g)if(this.getStdin!=null){if(this.stdinBuffer==null)this.stdinBuffer=this.getStdin();if(this.stdinBuffer!=null){if(i=this.stdinBuffer.copy(d),i==this.stdinBuffer.length)this.stdinBuffer=void 0;else this.stdinBuffer=this.stdinBuffer.slice(i);if(i>0)this.lastStdin=(new Date()).valueOf()}}else{if(this.sleep==null&&!U)U=!0,console.log("(cpu waiting for stdin: please define a way to sleep!) ");try{i=I.readSync(b.real,d,u,_,c)}catch(f){}if(i==0)this.shortPause();else this.lastStdin=(new Date()).valueOf()}else i=I.readSync(b.real,d,u,_,c);if(b.filetype==j.WASI_FILETYPE_REGULAR_FILE)b.offset=(b.offset?b.offset:BigInt(0))+BigInt(i);if(u+=i,l+=i,i===0||i<_)break W}}return this.view.setUint32(P,l,!0),j.WASI_ESUCCESS}),fd_readdir:q((h,w,m,P,b)=>{const g=L(h,j.WASI_RIGHT_FD_READDIR);this.refreshMemory();const l=I.readdirSync(g.path,{withFileTypes:!0}),d=w;for(let _=Number(P);_<l.length;_+=1){const c=l[_];let i=Buffer.byteLength(c.name);if(w-d>m)break;if(this.view.setBigUint64(w,BigInt(_+1),!0),w+=8,w-d>m)break;const f=I.lstatSync(K.resolve(g.path,c.name));if(this.view.setBigUint64(w,BigInt(f.ino),!0),w+=8,w-d>m)break;if(this.view.setUint32(w,i,!0),w+=4,w-d>m)break;let a;switch(!0){case f.isBlockDevice():a=j.WASI_FILETYPE_BLOCK_DEVICE;break;case f.isCharacterDevice():a=j.WASI_FILETYPE_CHARACTER_DEVICE;break;case f.isDirectory():a=j.WASI_FILETYPE_DIRECTORY;break;case f.isFIFO():a=j.WASI_FILETYPE_SOCKET_STREAM;break;case f.isFile():a=j.WASI_FILETYPE_REGULAR_FILE;break;case f.isSocket():a=j.WASI_FILETYPE_SOCKET_STREAM;break;case f.isSymbolicLink():a=j.WASI_FILETYPE_SYMBOLIC_LINK;break;default:a=j.WASI_FILETYPE_UNKNOWN;break}if(this.view.setUint8(w,a),w+=1,w+=3,w+i>=d+m)break;Buffer.from(this.memory.buffer).write(c.name,w),w+=i}const u=w-d;return this.view.setUint32(b,Math.min(u,m),!0),j.WASI_ESUCCESS}),fd_renumber:q((h,w)=>{return L(h,BigInt(0)),L(w,BigInt(0)),I.closeSync(this.FD_MAP.get(h).real),this.FD_MAP.set(h,this.FD_MAP.get(w)),this.FD_MAP.delete(w),j.WASI_ESUCCESS}),fd_seek:q((h,w,m,P)=>{const b=L(h,j.WASI_RIGHT_FD_SEEK);switch(this.refreshMemory(),m){case j.WASI_WHENCE_CUR:b.offset=(b.offset?b.offset:BigInt(0))+BigInt(w);break;case j.WASI_WHENCE_END:const{size:g}=this.fstatSync(b.real);b.offset=BigInt(g)+BigInt(w);break;case j.WASI_WHENCE_SET:b.offset=BigInt(w);break}if(b.offset==null)throw Error("stats.offset must be defined");return this.view.setBigUint64(P,b.offset,!0),j.WASI_ESUCCESS}),fd_tell:q((h,w)=>{const m=L(h,j.WASI_RIGHT_FD_TELL);if(this.refreshMemory(),!m.offset)m.offset=BigInt(0);return this.view.setBigUint64(w,m.offset,!0),j.WASI_ESUCCESS}),fd_sync:q((h)=>{const w=L(h,j.WASI_RIGHT_FD_SYNC);return I.fsyncSync(w.real),j.WASI_ESUCCESS}),path_create_directory:q((h,w,m)=>{const P=L(h,j.WASI_RIGHT_PATH_CREATE_DIRECTORY);if(!P.path)return j.WASI_EINVAL;this.refreshMemory();const b=Buffer.from(this.memory.buffer,w,m).toString();return I.mkdirSync(K.resolve(P.path,b)),j.WASI_ESUCCESS}),path_filestat_get:q((h,w,m,P,b)=>{const g=L(h,j.WASI_RIGHT_PATH_FILESTAT_GET);if(!g.path)return j.WASI_EINVAL;this.refreshMemory();const l=Buffer.from(this.memory.buffer,m,P).toString();let d;if(w)d=I.statSync(K.resolve(g.path,l));else d=I.lstatSync(K.resolve(g.path,l));return this.view.setBigUint64(b,BigInt(d.dev),!0),b+=8,this.view.setBigUint64(b,BigInt(d.ino),!0),b+=8,this.view.setUint8(b,M(this,void 0,d).filetype),b+=8,this.view.setBigUint64(b,BigInt(d.nlink),!0),b+=8,this.view.setBigUint64(b,BigInt(d.size),!0),b+=8,this.view.setBigUint64(b,BigInt(d.atime.getTime()*1e6),!0),b+=8,this.view.setBigUint64(b,BigInt(d.mtime.getTime()*1e6),!0),b+=8,this.view.setBigUint64(b,BigInt(d.ctime.getTime()*1e6),!0),j.WASI_ESUCCESS}),path_filestat_set_times:q((h,w,m,P,b,g,l)=>{const d=L(h,j.WASI_RIGHT_PATH_FILESTAT_SET_TIMES);if(!d.path)return j.WASI_EINVAL;this.refreshMemory();const u=this.fstatSync(d.real);let{atime:_,mtime:c}=u;const i=Z(C(j.WASI_CLOCK_REALTIME)),f=j.WASI_FILESTAT_SET_ATIM|j.WASI_FILESTAT_SET_ATIM_NOW;if((l&f)===f)return j.WASI_EINVAL;const a=j.WASI_FILESTAT_SET_MTIM|j.WASI_FILESTAT_SET_MTIM_NOW;if((l&a)===a)return j.WASI_EINVAL;if((l&j.WASI_FILESTAT_SET_ATIM)===j.WASI_FILESTAT_SET_ATIM)_=Z(b);else if((l&j.WASI_FILESTAT_SET_ATIM_NOW)===j.WASI_FILESTAT_SET_ATIM_NOW)_=i;if((l&j.WASI_FILESTAT_SET_MTIM)===j.WASI_FILESTAT_SET_MTIM)c=Z(g);else if((l&j.WASI_FILESTAT_SET_MTIM_NOW)===j.WASI_FILESTAT_SET_MTIM_NOW)c=i;const n=Buffer.from(this.memory.buffer,m,P).toString();return I.utimesSync(K.resolve(d.path,n),new Date(_),new Date(c)),j.WASI_ESUCCESS}),path_link:q((h,w,m,P,b,g,l)=>{const d=L(h,j.WASI_RIGHT_PATH_LINK_SOURCE),u=L(b,j.WASI_RIGHT_PATH_LINK_TARGET);if(!d.path||!u.path)return j.WASI_EINVAL;this.refreshMemory();const _=Buffer.from(this.memory.buffer,m,P).toString(),c=Buffer.from(this.memory.buffer,g,l).toString();return I.linkSync(K.resolve(d.path,_),K.resolve(u.path,c)),j.WASI_ESUCCESS}),path_open:q((h,w,m,P,b,g,l,d,u)=>{try{const _=L(h,j.WASI_RIGHT_PATH_OPEN);g=BigInt(g),l=BigInt(l);const c=(g&(j.WASI_RIGHT_FD_READ|j.WASI_RIGHT_FD_READDIR))!==BigInt(0),i=(g&(j.WASI_RIGHT_FD_DATASYNC|j.WASI_RIGHT_FD_WRITE|j.WASI_RIGHT_FD_ALLOCATE|j.WASI_RIGHT_FD_FILESTAT_SET_SIZE))!==BigInt(0);let f;if(i&&c)f=IW.O_RDWR;else if(c)f=IW.O_RDONLY;else if(i)f=IW.O_WRONLY;let a=g|j.WASI_RIGHT_PATH_OPEN,n=g|l;if((b&j.WASI_O_CREAT)!==0)f|=IW.O_CREAT,a|=j.WASI_RIGHT_PATH_CREATE_FILE;if((b&j.WASI_O_DIRECTORY)!==0)f|=IW.O_DIRECTORY;if((b&j.WASI_O_EXCL)!==0)f|=IW.O_EXCL;if((b&j.WASI_O_TRUNC)!==0)f|=IW.O_TRUNC,a|=j.WASI_RIGHT_PATH_FILESTAT_SET_SIZE;if((d&j.WASI_FDFLAG_APPEND)!==0)f|=IW.O_APPEND;if((d&j.WASI_FDFLAG_DSYNC)!==0){if(IW.O_DSYNC)f|=IW.O_DSYNC;else f|=IW.O_SYNC;n|=j.WASI_RIGHT_FD_DATASYNC}if((d&j.WASI_FDFLAG_NONBLOCK)!==0)f|=IW.O_NONBLOCK;if((d&j.WASI_FDFLAG_RSYNC)!==0){if(IW.O_RSYNC)f|=IW.O_RSYNC;else f|=IW.O_SYNC;n|=j.WASI_RIGHT_FD_SYNC}if((d&j.WASI_FDFLAG_SYNC)!==0)f|=IW.O_SYNC,n|=j.WASI_RIGHT_FD_SYNC;if(i&&(f&(IW.O_APPEND|IW.O_TRUNC))===0)n|=j.WASI_RIGHT_FD_SEEK;this.refreshMemory();const x=Buffer.from(this.memory.buffer,m,P).toString();if(x=="dev/tty")return this.view.setUint32(u,j.WASI_STDIN_FILENO,!0),j.WASI_ESUCCESS;if(Y("path_open",x),x.startsWith("proc/"))throw new O.WASIError(j.WASI_EBADF);const p=K.resolve(x);let r;try{r=I.realpathSync(p)}catch(t){if(t?.code==="ENOENT")r=p;else throw t}let e;if(i)try{e=I.statSync(r).isDirectory()}catch(t){}let o;if(!i&&e)o=I.openSync(r,IW.O_RDONLY);else o=I.openSync(r,f);const s=this.getUnusedFileDescriptor();this.FD_MAP.set(s,{real:o,filetype:void 0,rights:{base:a,inheriting:n},path:r}),J(this,s),this.view.setUint32(u,s,!0)}catch(_){console.error(_)}return j.WASI_ESUCCESS}),path_readlink:q((h,w,m,P,b,g)=>{const l=L(h,j.WASI_RIGHT_PATH_READLINK);if(!l.path)return j.WASI_EINVAL;this.refreshMemory();const d=Buffer.from(this.memory.buffer,w,m).toString(),u=K.resolve(l.path,d),_=I.readlinkSync(u),c=Buffer.from(this.memory.buffer).write(_,P,b);return this.view.setUint32(g,c,!0),j.WASI_ESUCCESS}),path_remove_directory:q((h,w,m)=>{const P=L(h,j.WASI_RIGHT_PATH_REMOVE_DIRECTORY);if(!P.path)return j.WASI_EINVAL;this.refreshMemory();const b=Buffer.from(this.memory.buffer,w,m).toString();return I.rmdirSync(K.resolve(P.path,b)),j.WASI_ESUCCESS}),path_rename:q((h,w,m,P,b,g)=>{const l=L(h,j.WASI_RIGHT_PATH_RENAME_SOURCE),d=L(P,j.WASI_RIGHT_PATH_RENAME_TARGET);if(!l.path||!d.path)return j.WASI_EINVAL;this.refreshMemory();const u=Buffer.from(this.memory.buffer,w,m).toString(),_=Buffer.from(this.memory.buffer,b,g).toString();return I.renameSync(K.resolve(l.path,u),K.resolve(d.path,_)),j.WASI_ESUCCESS}),path_symlink:q((h,w,m,P,b)=>{const g=L(m,j.WASI_RIGHT_PATH_SYMLINK);if(!g.path)return j.WASI_EINVAL;this.refreshMemory();const l=Buffer.from(this.memory.buffer,h,w).toString(),d=Buffer.from(this.memory.buffer,P,b).toString();return I.symlinkSync(l,K.resolve(g.path,d)),j.WASI_ESUCCESS}),path_unlink_file:q((h,w,m)=>{const P=L(h,j.WASI_RIGHT_PATH_UNLINK_FILE);if(!P.path)return j.WASI_EINVAL;this.refreshMemory();const b=Buffer.from(this.memory.buffer,w,m).toString();return I.unlinkSync(K.resolve(P.path,b)),j.WASI_ESUCCESS}),poll_oneoff:(h,w,m,P)=>{let b=0,g="",l=BigInt(0),d=-1,u="read",_=0;const c=BigInt(D.hrtime());this.refreshMemory();let i=h;for(let f=0;f<m;f+=1){const a=this.view.getBigUint64(h,!0);h+=8;const n=this.view.getUint8(h);if(h+=1,h+=7,N.enabled){if(n==j.WASI_EVENTTYPE_CLOCK)g="poll_oneoff (type=WASI_EVENTTYPE_CLOCK): ";else if(n==j.WASI_EVENTTYPE_FD_READ)g="poll_oneoff (type=WASI_EVENTTYPE_FD_READ): ";else g="poll_oneoff (type=WASI_EVENTTYPE_FD_WRITE): ";N(g)}switch(n){case j.WASI_EVENTTYPE_CLOCK:{const x=this.view.getUint32(h,!0);h+=4,h+=4;const p=this.view.getBigUint64(h,!0);h+=8,h+=8;const r=this.view.getUint16(h,!0);h+=2,h+=6;const e=r===1;if(N.enabled)N(g,{clockid:x,timeout:p,absolute:e});if(!e)_=p/BigInt(1e6);let o=j.WASI_ESUCCESS;const s=C(x);if(s==null)o=j.WASI_EINVAL;else{const t=BigInt(s),AW=(e?p:t+p)-t;if(AW>l)l=AW}this.view.setBigUint64(w,a,!0),w+=8,this.view.setUint16(w,o,!0),w+=2,this.view.setUint8(w,j.WASI_EVENTTYPE_CLOCK),w+=1,w+=5,b+=1;break}case j.WASI_EVENTTYPE_FD_READ:case j.WASI_EVENTTYPE_FD_WRITE:{if(d=this.view.getUint32(h,!0),u=n==j.WASI_EVENTTYPE_FD_READ?"read":"write",h+=4,N(g,"fd =",d),h+=28,this.view.setBigUint64(w,a,!0),w+=8,this.view.setUint16(w,j.WASI_ENOSYS,!0),w+=2,this.view.setUint8(w,n),w+=1,w+=5,b+=1,d==j.WASI_STDIN_FILENO&&j.WASI_EVENTTYPE_FD_READ==n)this.shortPause();break}default:return j.WASI_EINVAL}if(h-i!=48)console.warn("*** BUG in wasi-js in poll_oneoff ",{i:f,sin:h,last_sin:i,diff:h-i});i=h}if(this.view.setUint32(P,b,!0),b==2&&d>=0){const f=this.wasiImport.sock_pollSocket(d,u,_);if(f!=j.WASI_ENOSYS)return f}if(l>0){if(l-=Bun.nanoseconds()-v,l>=1e6){if(this.sleep==null&&!U)U=!0,console.log("(100% cpu burning waiting for stdin: please define a way to sleep!) ");if(this.sleep!=null){const f=Z(l);this.sleep(f)}else{const f=BigInt(D.hrtime())+l;while(BigInt(D.hrtime())<f);}}}return j.WASI_ESUCCESS},proc_exit:(h)=>{return D.exit(h),j.WASI_ESUCCESS},proc_raise:(h)=>{if(!(h in j.SIGNAL_MAP))return j.WASI_EINVAL;return D.kill(j.SIGNAL_MAP[h]),j.WASI_ESUCCESS},random_get:(h,w)=>{return this.refreshMemory(),crypto.getRandomValues(this.memory.buffer,h,w),w},sched_yield(){return j.WASI_ESUCCESS},sock_recv(){return j.WASI_ENOSYS},sock_send(){return j.WASI_ENOSYS},sock_shutdown(){return j.WASI_ENOSYS},sock_fcntlSetFlags(h,w){return j.WASI_ENOSYS},sock_pollSocket(h,w,m){return j.WASI_ENOSYS}},N.enabled)Object.keys(this.wasiImport).forEach((h)=>{const w=this.wasiImport[h];this.wasiImport[h]=function(...m){N(h,m);try{let P=w(...m);return N("result",P),P}catch(P){throw N("error: ",P),P}}})}getState(){return{env:this.env,FD_MAP:this.FD_MAP,bindings}}setState(T){this.env=T.env,this.FD_MAP=T.FD_MAP,bindings=T.bindings}fstatSync(T){if(T<=2)try{return I.fstatSync(T)}catch(k){const B=new Date;return{dev:0,mode:8592,nlink:1,uid:0,gid:0,rdev:0,blksize:65536,ino:0,size:0,blocks:0,atimeMs:B.valueOf(),mtimeMs:B.valueOf(),ctimeMs:B.valueOf(),birthtimeMs:0,atime:new Date,mtime:new Date,ctime:new Date,birthtime:new Date(0)}}return I.fstatSync(T)}shortPause(){if(this.sleep==null)return;if((new Date()).valueOf()-this.lastStdin>2000)this.sleep(50)}getUnusedFileDescriptor(T=3){let k=T;while(this.FD_MAP.has(k))k+=1;if(k>G)throw Error("no available file descriptors");return k}refreshMemory(){if(!this.view||this.view.buffer.byteLength===0)this.view=new DataView(this.memory.buffer)}setMemory(T){this.memory=T}start(T,k){const B=T.exports;if(B===null||typeof B!=="object")throw new Error(`instance.exports must be an Object. Received ${B}.`);if(k==null){if(k=B.memory,!(k instanceof WebAssembly.Memory))throw new Error(`instance.exports.memory must be a WebAssembly.Memory. Recceived ${k}.`)}if(this.setMemory(k),B._start)B._start()}getImports(T){let k=null;const B=WebAssembly.Module.imports(T);for(let H of B){if(H.kind!=="function")continue;if(!H.module.startsWith("wasi_"))continue;k=H.module;break}switch(k){case"wasi_unstable":return{wasi_unstable:this.wasiImport};case"wasi_snapshot_preview1":return{wasi_snapshot_preview1:this.wasiImport};default:throw new Error("No WASI namespace found. Only wasi_unstable and wasi_snapshot_preview1 are supported.\n\nList of imports:\n\n"+B.map(({name:H,kind:D,module:K})=>`${K}:${H} (${D})`).join("\n")+"\n")}}initWasiFdInfo(){if(this.env["WASI_FD_INFO"]!=null){const T=JSON.parse(this.env["WASI_FD_INFO"]);for(let k in T){console.log(k);const B=parseInt(k);if(this.FD_MAP.has(B))continue;const H=T[k];try{this.fstatSync(H)}catch(K){console.log("discarding ",{wasi_fd:k,real:H});continue}const D={real:H,filetype:j.WASI_FILETYPE_SOCKET_STREAM,rights:{base:Q,inheriting:BigInt(0)}};this.FD_MAP.set(B,D)}console.log("after initWasiFdInfo: ",this.FD_MAP),console.log("fdInfo = ",T)}else console.log("no WASI_FD_INFO")}};W.default=z}}),QW=jW(),VW=QW.default;QW[Symbol.for("CommonJS")]=0;var JW=QW;export{JW as default,QW as WASI};
